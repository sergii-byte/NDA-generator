<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash NDA Drafter | SBLC Business Lawyers</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F9F6F1;
            --bg-warm: #F4F0E8;
            --card: #FFFFFF;
            --card-hover: #FDFCFA;
            --border: #E5E0D5;
            --border-light: #EDE9E0;
            --text: #2B2926;
            --text-secondary: #6B6560;
            --text-muted: #9A9490;
            --accent: #D97757;
            --accent-hover: #C5684A;
            --accent-soft: rgba(217, 119, 87, 0.08);
            --accent-ring: rgba(217, 119, 87, 0.2);
            --green: #3D9A5F;
            --green-soft: rgba(61, 154, 95, 0.1);
            --yellow-soft: rgba(217, 176, 87, 0.15);
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.08);
            --radius: 12px;
            --radius-lg: 16px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
        header {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-inner {
            max-width: 1100px;
            margin: 0 auto;
            padding: 16px 24px 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }
        .logo-area h1 {
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.03em;
            color: var(--text);
        }
        .logo-area p {
            font-size: 0.82rem;
            color: var(--text-secondary);
            margin-top: 3px;
            font-weight: 400;
        }
        .logo-area a { text-decoration: none; color: inherit; }
        header img { height: 22px; opacity: 0.7; transition: opacity 0.2s; }
        header img:hover { opacity: 1; }
        .header-sub {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 24px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }
        .header-audience {
            font-size: 0.72rem;
            color: var(--text-muted);
            font-style: italic;
        }
        .trust-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .trust-badge {
            font-size: 0.65rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-warm);
            padding: 3px 10px;
            border-radius: 100px;
            border: 1px solid var(--border-light);
            white-space: nowrap;
        }
        .trust-badge a { color: var(--accent); text-decoration: none; font-weight: 600; }
        .trust-badge a:hover { text-decoration: underline; }
        .trust-badge-sep {
            color: var(--border);
            font-size: 0.7rem;
            user-select: none;
        }

        /* ‚îÄ‚îÄ‚îÄ Main ‚îÄ‚îÄ‚îÄ */
        main {
            max-width: 1100px;
            margin: 0 auto;
            padding: 28px 24px 24px;
        }

        /* ‚îÄ‚îÄ‚îÄ Party Type Toggle ‚îÄ‚îÄ‚îÄ */
        .label-with-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 2px;
        }
        .party-toggle {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            flex-shrink: 0;
        }
        .party-toggle input { display: none; }
        .party-toggle-track {
            position: relative;
            display: inline-flex;
            align-items: center;
            width: 140px;
            height: 26px;
            border-radius: 100px;
            background: var(--bg-warm);
            border: 1px solid var(--border);
            transition: background 0.2s;
            padding: 0 6px;
        }
        .party-toggle-thumb {
            position: absolute;
            left: 2px;
            width: 68px;
            height: 22px;
            border-radius: 100px;
            background: var(--accent);
            transition: left 0.2s ease;
            z-index: 1;
        }
        .party-toggle input:checked ~ .party-toggle-track .party-toggle-thumb {
            left: 70px;
        }
        .party-toggle-label-l, .party-toggle-label-r {
            flex: 1;
            text-align: center;
            font-size: 0.68rem;
            font-weight: 600;
            position: relative;
            z-index: 2;
            transition: color 0.2s;
            line-height: 26px;
        }
        .party-toggle-label-l { color: #fff; }
        .party-toggle-label-r { color: var(--text-muted); }
        .party-toggle input:checked ~ .party-toggle-track .party-toggle-label-l { color: var(--text-muted); }
        .party-toggle input:checked ~ .party-toggle-track .party-toggle-label-r { color: #fff; }

        /* ‚îÄ‚îÄ‚îÄ Stepper ‚îÄ‚îÄ‚îÄ */
        .stepper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 28px;
            flex-wrap: nowrap;
        }
        .step-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 100px;
            font-size: 0.78rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            white-space: nowrap;
        }
        .step-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        .step-badge.active {
            background: var(--accent);
            color: white;
            cursor: pointer;
        }
        .step-badge.done {
            background: var(--green-soft);
            color: var(--green);
            cursor: pointer;
        }
        .step-badge.done:hover { filter: brightness(0.95); }
        .step-badge.inactive {
            background: var(--bg-warm);
            color: var(--text-muted);
            border: 1px solid var(--border-light);
        }
        .step-num {
            width: 22px; height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }
        .step-badge.active .step-num { background: rgba(255,255,255,0.25); color: white; }
        .step-badge.done .step-num { background: var(--green); color: white; }
        .step-badge.inactive .step-num { background: var(--border); color: var(--text-muted); }
        .step-arrow { color: var(--border); font-size: 0.85rem; flex-shrink: 0; }
        .step-label-tip { position: relative; }
        .step-tip {
            position: absolute;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%) translateY(-4px);
            background: var(--text);
            color: white;
            font-size: 0.68rem;
            font-weight: 400;
            padding: 8px 12px;
            border-radius: 8px;
            width: 200px;
            line-height: 1.45;
            opacity: 0; visibility: hidden;
            transition: all 0.15s ease;
            z-index: 200;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-transform: none;
            letter-spacing: 0;
        }
        .step-tip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-bottom-color: var(--text);
        }
        .step-badge:hover .step-tip {
            opacity: 1; visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .step-label-flex { display: flex; align-items: center; gap: 5px; }
        @media (max-width: 900px) {
            .stepper { gap: 4px; }
            .step-badge { padding: 7px 10px; font-size: 0.72rem; gap: 5px; }
            .step-arrow { font-size: 0.75rem; }
        }
        @media (max-width: 700px) {
            .step-label { display: none !important; }
            .stepper { flex-wrap: wrap; justify-content: center; }
        }
        @media (max-width: 640px) { .step-arrow { display: none; } }
        @media (max-width: 640px) {
            .product-cards-grid { grid-template-columns: 1fr !important; }
        }

        /* ‚îÄ‚îÄ‚îÄ Cards ‚îÄ‚îÄ‚îÄ */
        .card {
            background: var(--card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }
        .card + .card { margin-top: 16px; }
        /* ‚îÄ‚îÄ‚îÄ Side-by-side Party Cards ‚îÄ‚îÄ‚îÄ */
        .parties-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            align-items: start;
        }
        .parties-row .card { margin-top: 0; }
        .parties-row .card .form-row {
            grid-template-columns: 1fr;
        }
        .parties-row .fill-tabs {

            flex-wrap: wrap;
            gap: 4px;
        }
        .parties-row .fill-tab {
            font-size: 0.7rem;
            padding: 5px 6px;
            gap: 3px;
        }
        .parties-row .fill-tab svg { width: 12px; height: 12px; }
        @media (max-width: 860px) {
            .parties-row { grid-template-columns: 1fr; }
            .parties-row .card .form-row { grid-template-columns: 1fr 1fr; }
            .parties-row .fill-tab { font-size: 0.75rem; padding: 6px 10px; gap: 5px; }
            .parties-row .fill-tab svg { width: 14px; height: 14px; }
        }
        @media (max-width: 640px) {
            .parties-row .card .form-row { grid-template-columns: 1fr; }
        }
        .card-title {
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 1.05rem;
            font-weight: 600;
            letter-spacing: -0.01em;
            color: var(--text);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-title .badge {
            font-family: 'Inter', sans-serif;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 3px 8px;
            border-radius: 4px;
            background: var(--accent-soft);
            color: var(--accent);
        }

        /* ‚îÄ‚îÄ‚îÄ Info Banner ‚îÄ‚îÄ‚îÄ */
        .info-banner {
            background: var(--bg-warm);
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 14px 18px;
            margin-bottom: 16px;
            font-size: 0.88rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .info-banner strong { color: var(--text); }

        /* ‚îÄ‚îÄ‚îÄ Form Elements ‚îÄ‚îÄ‚îÄ */
        .form-group { margin-bottom: 16px; }
        .form-group:last-child { margin-bottom: 0; }

        /* form-fields: flexbox column with uniform gap ‚Äî resets all inner margins */
        .form-fields {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .form-fields .form-group,
        .form-fields .form-row,
        .form-fields .form-row .form-group,
        .form-fields .form-group:last-child { margin-bottom: 0; }

        /* Section divider inside form-fields ‚Äî extra breathing room */
        .form-divider {
            border: none;
            border-top: 1px solid var(--border-light);
            margin: 4px 0;
        }
        /* Section sub-header labels */
        .form-section-label {
            font-weight: 600;
            font-size: 0.78rem;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: -6px;
        }
        .form-section-label span {
            font-weight: 400;
            text-transform: none;
            color: var(--text-muted);
            letter-spacing: 0;
        }

        /* ‚îÄ‚îÄ‚îÄ Checklist ‚îÄ‚îÄ‚îÄ */
        .checklist {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
            font-size: 0.82rem;
            font-weight: 400;
            color: var(--text-secondary);
            line-height: 1.45;
            margin-bottom: 0;
        }
        .checklist-item:hover { background: var(--bg-warm); }
        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            margin-top: 1px;
            accent-color: var(--green);
            cursor: pointer;
        }
        .checklist-item:has(input:checked) span {
            color: var(--text-muted);
            text-decoration: line-through;
            text-decoration-color: var(--border);
        }
        .checklist-item strong {
            color: var(--text);
            font-weight: 600;
        }
        .checklist-item:has(input:checked) strong {
            color: var(--text-muted);
        }

        /* ‚îÄ‚îÄ‚îÄ NDA Strength Meter ‚îÄ‚îÄ‚îÄ */
        .strength-meter {
            padding: 16px 20px;
            border-radius: var(--radius);
            background: var(--card);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            margin-top: 16px;
        }
        .strength-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .strength-title {
            font-size: 0.78rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .score-tip {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px; height: 16px;
            border-radius: 50%;
            background: var(--bg-warm);
            border: 1px solid var(--border-light);
            font-size: 0.6rem;
            color: var(--text-muted);
            cursor: help;
            flex-shrink: 0;
            text-transform: none;
            letter-spacing: 0;
        }
        .score-tip:hover .score-tip-text {
            opacity: 1; visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .score-tip-text {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%) translateY(4px);
            background: var(--text);
            color: white;
            font-size: 0.68rem;
            font-weight: 400;
            padding: 8px 12px;
            border-radius: 8px;
            width: 240px;
            line-height: 1.45;
            opacity: 0; visibility: hidden;
            transition: all 0.15s ease;
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .strength-label {
            font-size: 0.85rem;
            font-weight: 700;
            padding: 2px 10px;
            border-radius: 6px;
        }
        .strength-bar-bg {
            height: 8px;
            border-radius: 4px;
            background: var(--border-light);
            overflow: hidden;
            margin-bottom: 10px;
        }
        .strength-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s ease, background 0.4s ease;
        }
        .strength-scale {
            display: flex;
            justify-content: space-between;
            font-size: 0.68rem;
            color: var(--text-muted);
        }
        .strength-breakdown {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .strength-tag {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: 500;
        }
        .strength-tag.active {
            background: var(--green-soft);
            color: var(--green);
        }
        .strength-tag.inactive {
            background: var(--bg-warm);
            color: var(--text-muted);
        }

        .confidence-section {
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid var(--border-light);
        }
        .confidence-note {
            font-size: 0.75rem;
            line-height: 1.45;
            color: var(--text-muted);
            margin-top: 6px;
        }
        .confidence-note a {
            color: var(--accent);
            font-weight: 600;
            text-decoration: none;
        }

        /* ‚îÄ‚îÄ‚îÄ AI Disclaimer ‚îÄ‚îÄ‚îÄ */
        .ai-disclaimer {
            display: flex;
            gap: 10px;
            padding: 14px 16px;
            border-radius: var(--radius);
            background: #FFF8F0;
            border: 1px solid #F0DCC8;
            color: #8B6914;
            font-size: 0.78rem;
            line-height: 1.5;
            margin-top: 16px;
        }
        .ai-disclaimer strong { color: #7A5A0A; }
        .ai-disclaimer a.disclaimer-cta {
            color: var(--accent);
            font-weight: 600;
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        /* ‚îÄ‚îÄ‚îÄ Documents Panel ‚îÄ‚îÄ‚îÄ */
        .docs-panel {
            padding: 16px 20px;
            border-radius: var(--radius);
            background: var(--card);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .docs-panel-title {
            font-size: 0.78rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 10px;
        }
        .docs-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .doc-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-radius: 8px;
            background: var(--bg-warm);
            font-size: 0.82rem;
        }
        .doc-item-name {
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .doc-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px; height: 28px;
            border-radius: 8px;
            font-size: 0.82rem;
            flex-shrink: 0;
        }
        .doc-item-actions {
            display: flex;
            gap: 6px;
        }
        .doc-item-actions button {
            padding: 4px 10px;
            font-size: 0.72rem;
            border-radius: 6px;
            border: 1px solid var(--border-light);
            background: var(--card);
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
        }
        .doc-item-actions button:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* ‚îÄ‚îÄ‚îÄ Product Cards ‚îÄ‚îÄ‚îÄ */
        .product-cards-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
        }
        .product-card {
            border-radius: var(--radius);
            padding: 16px;
            border: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card--playbook { background: linear-gradient(135deg, #FAFAF8 0%, #FFF8F5 100%); border-color: var(--accent-ring); }
        .product-card--audit { background: linear-gradient(135deg, #F6FBF8 0%, #F0FAF4 100%); border-color: #C8E6D0; }
        .product-badge {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            padding: 3px 8px;
            border-radius: 5px;
        }
        .product-card-title { font-size: 0.88rem; font-weight: 600; margin-bottom: 5px; line-height: 1.3; }
        .product-card-desc { font-size: 0.74rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }
        .product-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 9px 16px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.78rem;
            opacity: 0.5;
            cursor: not-allowed;
            width: 100%;
            justify-content: center;
        }
        .product-meta { font-size: 0.65rem; color: var(--text-muted); text-align: center; margin-top: 5px; }
        @media (max-width: 640px) { .product-cards-grid { grid-template-columns: 1fr; } }

        /* ‚îÄ‚îÄ‚îÄ Scales Visualization ‚îÄ‚îÄ‚îÄ */
        .scales-viz {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding: 8px 0 4px 0;
        }
        .scales-svg { width: 120px; height: 60px; }

        .field-hint {
            font-size: 0.72rem;
            color: var(--text-muted);
            line-height: 1.35;
            margin-top: 4px;
        }
        /* Collapsible hint with ‚ìò toggle */
        .hint-wrap {
            margin-top: 5px;
        }
        .hint-wrap summary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-muted);
            background: var(--bg-warm);
            border: 1px solid var(--border-light);
            cursor: pointer;
            list-style: none;
            transition: all 0.2s;
            user-select: none;
        }
        .hint-wrap summary::-webkit-details-marker { display: none; }
        .hint-wrap summary:hover {
            color: var(--accent);
            border-color: var(--accent);
            background: var(--accent-soft);
        }
        .hint-wrap[open] summary {
            color: var(--accent);
            border-color: var(--accent);
            background: var(--accent-soft);
        }
        .hint-wrap .field-hint {
            margin-top: 6px;
            animation: hintFade 0.15s ease;
        }
        @keyframes hintFade {
            from { opacity: 0; transform: translateY(-4px); }
            to { opacity: 1; transform: translateY(0); }
        }
        label {
            display: block;
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: var(--text);
            background: var(--card);
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
        }
        input::placeholder, textarea::placeholder { color: var(--text-muted); }
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-ring);
        }
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239A9490' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 32px;
            cursor: pointer;
        }
        textarea { resize: vertical; min-height: 80px; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        @media (max-width: 640px) { .form-row { grid-template-columns: 1fr; } }

        /* ‚îÄ‚îÄ‚îÄ Autofill Tabs ‚îÄ‚îÄ‚îÄ */
        .fill-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .fill-tab {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 0.78rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        .fill-tab:hover { background: var(--bg-warm); border-color: var(--accent); color: var(--accent); }
        .fill-tab.active { background: var(--accent); border-color: var(--accent); color: white; }
        .fill-tab svg { width: 14px; height: 14px; }

        /* ‚îÄ‚îÄ‚îÄ Autocomplete ‚îÄ‚îÄ‚îÄ */
        .autocomplete-wrap { position: relative; }
        .autocomplete-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0; right: 0;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            max-height: 280px;
            overflow-y: auto;
            z-index: 50;
            box-shadow: var(--shadow-lg);
        }
        .autocomplete-item {
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-light);
            transition: background 0.15s;
        }
        .autocomplete-item:hover { background: var(--bg-warm); }
        .autocomplete-item:last-child { border-bottom: none; }
        .ac-name { font-weight: 600; font-size: 0.88rem; color: var(--text); }
        .ac-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }
        .ac-tag {
            font-size: 0.7rem;
            padding: 2px 7px;
            border-radius: 4px;
            font-weight: 500;
        }
        .ac-tag.code { background: var(--bg-warm); color: var(--text-secondary); font-family: 'SF Mono', 'Fira Code', monospace; }
        .ac-tag.jurisdiction { background: #EEF2FF; color: #4F46E5; }
        .ac-tag.status { background: var(--green-soft); color: var(--green); }
        .ac-tag.address-ok { background: var(--green-soft); color: var(--green); }
        .ac-tag.address-missing { background: var(--yellow-soft); color: #B8860B; }
        .ac-tag.source { background: #FFF7ED; color: #C2410C; font-size: 0.65rem; }
        .ac-address { font-size: 0.78rem; color: var(--text-muted); margin-top: 3px; }
        .ac-loading {
            padding: 16px;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        .ac-loading .spinner {
            display: inline-block;
            width: 16px; height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ‚îÄ Checkboxes ‚îÄ‚îÄ‚îÄ */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        @media (max-width: 640px) { .checkbox-grid { grid-template-columns: 1fr; } }
        .checkbox-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }
        .checkbox-card:hover { border-color: var(--accent); background: var(--accent-soft); }
        .checkbox-card input[type="checkbox"] {
            width: 16px;
            height: 16px;
            min-width: 16px;
            margin: 0;
            accent-color: var(--accent);
            cursor: pointer;
            flex-shrink: 0;
        }
        .checkbox-card span {
            line-height: 1.3;
        }
        .checkbox-card input:checked + span { color: var(--text); font-weight: 500; }

        /* ‚îÄ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ‚îÄ */
        .btn-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--accent);
            color: white;
        }
        .btn-primary:hover { background: var(--accent-hover); box-shadow: 0 4px 16px var(--accent-ring); transform: translateY(-1px); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-hero {
            padding: 18px 28px;
            font-size: 1.05rem;
            font-weight: 700;
            border-radius: 14px;
            box-shadow: 0 2px 12px var(--accent-ring);
            letter-spacing: -0.01em;
        }
        .btn-hero:hover { box-shadow: 0 6px 24px var(--accent-ring); transform: translateY(-2px); }

        .btn-secondary {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--card);
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover { background: var(--bg-warm); border-color: var(--accent); color: var(--accent); }

        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.88rem;
            color: var(--text-muted);
            cursor: pointer;
            background: none;
            border: none;
            font-family: 'Inter', sans-serif;
            transition: color 0.2s;
            margin-bottom: 16px;
        }
        .btn-back:hover { color: var(--accent); }

        /* ‚îÄ‚îÄ‚îÄ NDA Output Styling ‚îÄ‚îÄ‚îÄ */
        .nda-output-wrap {
            background: var(--card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }
        .nda-output-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }
        .nda-output-header h3 {
            font-family: 'Inter', -apple-system, sans-serif;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nda-output-actions {
            display: flex;
            gap: 8px;
        }

        /* ‚îÄ‚îÄ‚îÄ Generated NDA Document ‚îÄ‚îÄ‚îÄ */
        .generated-nda {
            background: #FFFEFA;
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 40px 48px;
            max-height: 600px;
            overflow-y: auto;
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 0.92rem;
            line-height: 1.85;
            color: #1A1A1A;
        }
        .generated-nda::-webkit-scrollbar { width: 6px; }
        .generated-nda::-webkit-scrollbar-track { background: transparent; }
        .generated-nda::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        .generated-nda::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        .generated-nda h1 {
            font-family: Georgia, serif;
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin: 0 0 1.2em 0;
            padding-bottom: 0.8em;
            border-bottom: 2px solid #1A1A1A;
        }
        .generated-nda h2 {
            font-family: Georgia, serif;
            font-size: 1.05rem;
            font-weight: bold;
            margin: 1.8em 0 0.6em 0;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        .generated-nda h3 {
            font-family: Georgia, serif;
            font-size: 0.95rem;
            font-weight: bold;
            margin: 1.4em 0 0.5em 0;
        }
        .generated-nda p {
            margin: 0 0 0.9em 0;
            text-align: justify;
            hyphens: auto;
        }
        .generated-nda strong { font-weight: bold; }
        .generated-nda em { font-style: italic; }
        .generated-nda ul, .generated-nda ol {
            margin: 0.6em 0 0.9em 1.8em;
        }
        .generated-nda li {
            margin-bottom: 0.4em;
            text-align: justify;
        }
        .generated-nda hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2em 0;
        }
        .generated-nda table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
        }
        .generated-nda th, .generated-nda td {
            padding: 10px 16px;
            border: 1px solid var(--border);
            text-align: left;
            vertical-align: top;
        }
        @media (max-width: 640px) {
            .generated-nda { padding: 24px 20px; font-size: 0.85rem; }
        }

        /* ‚îÄ‚îÄ‚îÄ Summary Output ‚îÄ‚îÄ‚îÄ */
        .summary-content {
            background: #FFFEFA;
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 28px 32px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 0.92rem;
            line-height: 1.75;
            color: var(--text);
        }
        .summary-content h1, .summary-content h2, .summary-content h3 {
            font-family: 'Inter', -apple-system, sans-serif;
            font-weight: 600;
            margin: 1.2em 0 0.5em 0;
        }
        .summary-content h1 { font-size: 1.3rem; }
        .summary-content h2 { font-size: 1.1rem; }
        .summary-content p { margin-bottom: 0.8em; }
        .summary-content ul, .summary-content ol { margin: 0.5em 0 0.8em 1.5em; }
        .summary-content li { margin-bottom: 0.3em; }

        /* ‚îÄ‚îÄ‚îÄ Loading ‚îÄ‚îÄ‚îÄ */
        .loading-state {
            padding: 40px;
            text-align: center;
        }
        .loading-spinner {
            width: 36px; height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin: 0 auto 14px;
        }
        .loading-text { color: var(--text-secondary); font-size: 0.9rem; }

        /* ‚îÄ‚îÄ‚îÄ Footer ‚îÄ‚îÄ‚îÄ */
        footer {
            border-top: 1px solid var(--border);
            background: var(--card);
            margin-top: 24px;
        }
        .legal-disclaimer-bar {
            max-width: 1100px;
            margin: 0 auto;
            padding: 16px 24px;
            text-align: center;
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-warm);
        }
        .legal-disclaimer-bar p {
            font-size: 0.72rem;
            line-height: 1.55;
            color: var(--text-secondary);
            max-width: 620px;
            margin: 0 auto;
        }
        .legal-disclaimer-bar strong { color: var(--text); }
        .footer-inner {
            max-width: 1100px;
            margin: 0 auto;
            padding: 18px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }
        footer p, footer a { font-size: 0.8rem; color: var(--text-muted); }
        footer a { text-decoration: none; transition: color 0.2s; }
        footer a:hover { color: var(--accent); }

        /* ‚îÄ‚îÄ‚îÄ CTA Footer ‚îÄ‚îÄ‚îÄ */
        .cta-banner {
            background: linear-gradient(135deg, var(--accent-soft), #FFF7ED);
            border: 1px solid var(--accent-ring);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-top: 24px;
            text-align: center;
        }
        .cta-banner h4 {
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .cta-banner p { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 14px; }
        .cta-links { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .cta-links a {
            padding: 8px 20px;
            border-radius: 10px;
            font-size: 0.82rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
        }
        .cta-links .cta-primary { background: var(--accent); color: white; }
        .cta-links .cta-primary:hover { background: var(--accent-hover); }
        .cta-links .cta-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text-secondary); }
        .cta-links .cta-secondary:hover { border-color: var(--accent); color: var(--accent); }

        /* ‚îÄ‚îÄ‚îÄ Testimonials ‚îÄ‚îÄ‚îÄ */
        .testimonials-section {
            background: var(--bg-warm);
            border-top: 1px solid var(--border-light);
            padding: 32px 24px;
            margin-top: 24px;
        }
        .testimonials-inner {
            max-width: 1100px;
            margin: 0 auto;
        }
        .testimonials-title {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: center;
            margin-bottom: 20px;
        }
        .testimonials-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        .testimonial-card {
            background: var(--card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 20px 24px;
            box-shadow: var(--shadow-sm);
        }
        .testimonial-stars {
            color: #E8A838;
            font-size: 0.85rem;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        .testimonial-text {
            font-size: 0.82rem;
            line-height: 1.65;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 14px;
        }
        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .testimonial-avatar {
            width: 36px; height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a1a, #333);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.82rem;
            flex-shrink: 0;
        }
        .testimonial-logo {
            width: 36px; height: 36px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            background: #1a1a1a;
        }
        .testimonial-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text);
        }
        .testimonial-role {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        .testimonial-role a {
            color: var(--accent);
            text-decoration: none;
        }
        .testimonial-role a:hover { text-decoration: underline; }

        .hidden { display: none !important; }
        .space-y > * + * { margin-top: 16px; }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-inner">
            <div class="logo-area">
                <div>
                    <h1>‚ö° Flash NDA Drafter</h1>
                    <p>Designed by lawyers. From draft to sharing. Easy.</p>
                </div>
            </div>
            <a href="https://sblc.com.ua" target="_blank">
                <img src="https://framerusercontent.com/images/LkOVePWb0KiTp4xC1AZiukuRY9M.svg" alt="SBLC Law Firm">
            </a>
        </div>
        <div class="header-sub">
            <span class="header-audience">For founders, startups, and service providers who need legally sound and customizable NDAs.</span>
            <span class="trust-badges">
                <span class="trust-badge">‚öñÔ∏è Lawyer-Prompted AI</span>
                <span class="trust-badge-sep">¬∑</span>
                <span class="trust-badge">‚è± Draft in 30 seconds</span>
                <span class="trust-badge-sep">¬∑</span>
                <span class="trust-badge">üõ°Ô∏è Real Lawyer Review ¬∑ 24h</span>
            </span>
        </div>
    </header>

    <main>
        <!-- Stepper -->
        <div class="stepper">
            <div id="step1-badge" class="step-badge active" onclick="navigateStep(1)">
                <span class="step-num">1</span>
                <span class="step-label step-label-tip">Create Draft <span class="step-tip">Fill in party details and agreement terms to generate your NDA.</span></span>
            </div>
            <span class="step-arrow">‚Ä∫</span>
            <div id="step2-badge" class="step-badge inactive" onclick="navigateStep(2)">
                <span class="step-num">2</span>
                <span class="step-label step-label-tip">Advanced Clauses <span class="step-tip">Optional step for experienced users to add stricter or custom clauses.</span></span>
            </div>
            <span class="step-arrow">‚Ä∫</span>
            <div id="step3-badge" class="step-badge inactive" onclick="navigateStep(3)">
                <span class="step-num">3</span>
                <span class="step-label step-label-tip">NDA Checklist <span class="step-tip">Quick checks to confirm key terms before sharing.</span></span>
            </div>
            <span class="step-arrow">‚Ä∫</span>
            <div id="step4-badge" class="step-badge inactive" onclick="navigateStep(4)">
                <span class="step-num">4</span>
                <span class="step-label step-label-tip step-label-flex">Lawyer Review <span style="font-size:0.6rem;color:var(--green);font-weight:600;opacity:0.8;">‚òÖ</span> <span class="step-tip">Real lawyer review to verify enforceability and jurisdictional compliance.</span></span>
            </div>
            <span class="step-arrow">‚Ä∫</span>
            <div id="step5-badge" class="step-badge inactive" onclick="navigateStep(5)">
                <span class="step-num">5</span>
                <span class="step-label step-label-tip">Final Summary <span class="step-tip">Plain-language explanation of your NDA for the counterparty.</span></span>
            </div>
            <span class="step-arrow">‚Ä∫</span>
            <div id="step6-badge" class="step-badge inactive" onclick="navigateStep(6)">
                <span class="step-num">6</span>
                <span class="step-label step-label-tip">Send NDA <span class="step-tip">Pre-fill a professional cover email and send to your counterparty.</span></span>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEP 1: Flash NDA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="step1" class="space-y">
            <div class="parties-row">
            <!-- Party A -->
            <div class="card">
                <div class="card-title">
                    Disclosing Party
                    <span class="badge">Party A</span>
                </div>

                <div class="fill-tabs" id="fillTabsA">
                    <button class="fill-tab active" onclick="setFillMode('A','search',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                        Search
                    </button>
                    <button class="fill-tab" onclick="setFillMode('A','website',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                        Website
                    </button>
                    <button class="fill-tab" onclick="setFillMode('A','email',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                        Email
                    </button>
                    <button class="fill-tab" onclick="setFillMode('A','card',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                        Card
                    </button>
                    <button class="fill-tab" onclick="setFillMode('A','history',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        History
                    </button>
                </div>

                <!-- Search Mode -->
                <div id="fillA-search" class="fill-content">
                    <div class="form-group autocomplete-wrap">
                        <label>Search company register</label>
                        <input type="text" id="searchA" autocomplete="off" placeholder="Type company name..." oninput="searchCompany('A', this.value)">
                        <div id="dropdownA" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <!-- Website Mode -->
                <div id="fillA-website" class="fill-content hidden">
                    <div class="form-group" style="display:flex;gap:8px;">
                        <input type="url" id="websiteA" placeholder="https://company.com" style="flex:1;">
                        <button class="btn-secondary" onclick="parseWebsite('A')">Fetch</button>
                    </div>
                </div>
                <!-- Email Mode -->
                <div id="fillA-email" class="fill-content hidden">
                    <div class="form-group" style="display:flex;gap:8px;">
                        <input type="email" id="emailFillA" placeholder="contact@company.com" style="flex:1;">
                        <button class="btn-secondary" onclick="parseEmail('A')">Fetch</button>
                    </div>
                </div>
                <!-- Card Mode -->
                <div id="fillA-card" class="fill-content hidden">
                    <div class="form-group" style="display:flex;gap:8px;">
                        <input type="file" id="cardA" accept="image/*" style="flex:1;">
                        <button class="btn-secondary" onclick="parseCard('A')">Scan</button>
                    </div>
                </div>
                <!-- History Mode -->
                <div id="fillA-history" class="fill-content hidden">
                    <div class="form-group">
                        <label>Load from history</label>
                        <select id="historyA" onchange="loadFromHistory('A', this.value)">
                            <option value="">Select previous entry...</option>
                        </select>
                    </div>
                </div>

                <div class="form-fields" style="margin-top:16px;">
                    <input type="hidden" id="partyAType" value="Company">
                    <div class="form-group">
                        <div class="label-with-toggle">
                            <label id="partyANameLabel">Company Name *</label>
                            <label class="party-toggle" title="Switch between company and individual">
                                <input type="checkbox" id="partyAKind" onchange="togglePartyKind('A')">
                                <span class="party-toggle-track">
                                    <span class="party-toggle-label-l">Company</span>
                                    <span class="party-toggle-thumb"></span>
                                    <span class="party-toggle-label-r">Individual</span>
                                </span>
                            </label>
                        </div>
                        <input type="text" id="partyAName" autocomplete="off" placeholder="Full legal name">
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="partyACompanyNumberGroup">
                            <label>Company Number</label>
                            <input type="text" id="partyACompanyNumber" autocomplete="off" placeholder="Registration number">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="partyAEmail" autocomplete="off" placeholder="contact@company.com">
                        </div>
                    </div>
                    <div class="form-group">
                        <label id="partyAAddressLabel">Registered Address *</label>
                        <input type="text" id="partyAAddress" autocomplete="off" placeholder="Full registered address">
                    </div>
                    <hr class="form-divider" id="partyASignatoryDivider">
                    <div class="form-row" id="partyASignatoryRow">
                        <div class="form-group">
                            <label>Signatory Name</label>
                            <input type="text" id="partyASignatory" autocomplete="off" placeholder="Full name of signatory">
                        </div>
                        <div class="form-group">
                            <label>Signatory Title</label>
                            <input type="text" id="partyATitle" autocomplete="off" placeholder="e.g. CEO, Director, Managing Partner">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Party B -->
            <div class="card">
                <div class="card-title">
                    Receiving Party
                    <span class="badge">Party B</span>
                </div>

                <div class="fill-tabs" id="fillTabsB">
                    <button class="fill-tab active" onclick="setFillMode('B','search',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                        Search
                    </button>
                    <button class="fill-tab" onclick="setFillMode('B','website',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                        Website
                    </button>
                    <button class="fill-tab" onclick="setFillMode('B','email',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                        Email
                    </button>
                    <button class="fill-tab" onclick="setFillMode('B','card',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                        Card
                    </button>
                    <button class="fill-tab" onclick="setFillMode('B','history',this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        History
                    </button>
                </div>

                <div id="fillB-search" class="fill-content">
                    <div class="form-group autocomplete-wrap">
                        <label>Search company register</label>
                        <input type="text" id="searchB" autocomplete="off" placeholder="Type company name..." oninput="searchCompany('B', this.value)">
                        <div id="dropdownB" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div id="fillB-website" class="fill-content hidden">
                    <div class="form-group" style="display:flex;gap:8px;">
                        <input type="url" id="websiteB" placeholder="https://company.com" style="flex:1;">
                        <button class="btn-secondary" onclick="parseWebsite('B')">Fetch</button>
                    </div>
                </div>
                <div id="fillB-email" class="fill-content hidden">
                    <div class="form-group" style="display:flex;gap:8px;">
                        <input type="email" id="emailFillB" placeholder="contact@company.com" style="flex:1;">
                        <button class="btn-secondary" onclick="parseEmail('B')">Fetch</button>
                    </div>
                </div>
                <div id="fillB-card" class="fill-content hidden">
                    <div class="form-group" style="display:flex;gap:8px;">
                        <input type="file" id="cardB" accept="image/*" style="flex:1;">
                        <button class="btn-secondary" onclick="parseCard('B')">Scan</button>
                    </div>
                </div>
                <div id="fillB-history" class="fill-content hidden">
                    <div class="form-group">
                        <label>Load from history</label>
                        <select id="historyB" onchange="loadFromHistory('B', this.value)">
                            <option value="">Select previous entry...</option>
                        </select>
                    </div>
                </div>

                <div class="form-fields" style="margin-top:16px;">
                    <input type="hidden" id="partyBType" value="Company">
                    <div class="form-group">
                        <div class="label-with-toggle">
                            <label id="partyBNameLabel">Company Name *</label>
                            <label class="party-toggle" title="Switch between company and individual">
                                <input type="checkbox" id="partyBKind" onchange="togglePartyKind('B')">
                                <span class="party-toggle-track">
                                    <span class="party-toggle-label-l">Company</span>
                                    <span class="party-toggle-thumb"></span>
                                    <span class="party-toggle-label-r">Individual</span>
                                </span>
                            </label>
                        </div>
                        <input type="text" id="partyBName" autocomplete="off" placeholder="Full legal name">
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="partyBCompanyNumberGroup">
                            <label>Company Number</label>
                            <input type="text" id="partyBCompanyNumber" autocomplete="off" placeholder="Registration number">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="partyBEmail" autocomplete="off" placeholder="contact@company.com">
                        </div>
                    </div>
                    <div class="form-group">
                        <label id="partyBAddressLabel">Registered Address *</label>
                        <input type="text" id="partyBAddress" autocomplete="off" placeholder="Full registered address">
                    </div>
                    <hr class="form-divider" id="partyBSignatoryDivider">
                    <div class="form-row" id="partyBSignatoryRow">
                        <div class="form-group">
                            <label>Signatory Name</label>
                            <input type="text" id="partyBSignatory" autocomplete="off" placeholder="Full name of signatory">
                        </div>
                        <div class="form-group">
                            <label>Signatory Title</label>
                            <input type="text" id="partyBTitle" autocomplete="off" placeholder="e.g. CEO, Director, Managing Partner">
                        </div>
                    </div>
                    <hr class="form-divider">
                    <div class="form-group">
                        <label>Counterparty Role</label>
                        <select id="partyBRole" onchange="toggleCustomRole()">
                            <option value="Contractor">Contractor</option>
                            <option value="Employee">Employee</option>
                            <option value="Investor">Investor</option>
                            <option value="Partner">Partner</option>
                            <option value="Vendor">Vendor</option>
                            <option value="Client">Client</option>
                            <option value="Advisor">Advisor</option>
                            <option value="custom">Write your own...</option>
                        </select>
                        <input type="text" id="partyBRoleCustom" class="hidden" style="margin-top:6px;" autocomplete="off" placeholder="e.g. Franchisee, Licensor, Co-founder">
                    </div>
                </div>
            </div>
            </div><!-- end parties-row -->

            <!-- NDA Terms -->
            <div class="card">
                <div class="card-title">Agreement Terms</div>

                <div class="form-fields">
                    <div class="form-group">
                        <label>Purpose of Disclosure</label>
                        <select id="purposeSelect" onchange="toggleCustomPurpose()">
                            <option value="To evaluate and pursue a potential business collaboration between the Parties.">Business collaboration</option>
                            <option value="To evaluate a potential investment opportunity, including the review of financial, operational, and corporate information.">Investment / Due diligence</option>
                            <option value="To explore and negotiate a potential merger, acquisition, or sale of business assets between the Parties.">M&A / Acquisition</option>
                            <option value="To discuss and evaluate a potential joint venture, strategic alliance, or co-development arrangement.">Joint venture / Partnership</option>
                            <option value="To evaluate and negotiate a potential technology licensing, white-label, or reseller arrangement.">Licensing / White-label</option>
                            <option value="To discuss and negotiate the terms of a potential software development or technology services engagement.">Software / Tech services</option>
                            <option value="To evaluate and negotiate the provision of consulting, advisory, or professional services.">Consulting / Advisory</option>
                            <option value="To evaluate and negotiate a potential vendor, supplier, or outsourcing engagement.">Vendor / Supplier</option>
                            <option value="To engage an independent contractor or employee for the provision of services or employment requiring access to confidential business information.">Contractor / Employee engagement</option>
                            <option value="custom">Write your own...</option>
                        </select>
                        <textarea id="purposeCustom" class="hidden" style="margin-top:8px;" placeholder="Describe the purpose of disclosure..."></textarea>
                        <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Defines the <strong>only</strong> permitted use of shared information<br>‚Ä¢ Any use outside this purpose = breach of NDA<br>‚Ä¢ Pick the closest match, or "Write your own" for unusual deals<br>‚Ä¢ A clear purpose helps enforce the NDA in court</p></details>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>NDA Type</label>
                            <select id="ndaType">
                                <option value="Mutual">Mutual (both parties)</option>
                                <option value="Unilateral">Unilateral (one-way)</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint"><strong>Mutual</strong> ‚Äî both parties share and protect information. Best for partnerships, JVs, collaborations.<br><strong>Unilateral</strong> ‚Äî only one side discloses. Best for investor due diligence, contractors.<br>‚Ä¢ When in doubt ‚Üí choose Mutual (more balanced, easier to negotiate)</p></details>
                        </div>
                        <div class="form-group">
                            <label>Effective Date</label>
                            <input type="date" id="agreementDate">
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Date when NDA obligations begin<br>‚Ä¢ Can be <strong>backdated</strong> to cover prior discussions (standard practice)<br>‚Ä¢ Defaults to today if left blank</p></details>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Confidentiality Period</label>
                            <select id="confPeriod">
                                <option value="1">1 year</option>
                                <option value="2" selected>2 years</option>
                                <option value="3">3 years</option>
                                <option value="5">5 years</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ <strong>1 year</strong> ‚Äî short-term, low-sensitivity deals<br>‚Ä¢ <strong>2 years</strong> ‚Äî industry standard for most deals<br>‚Ä¢ <strong>3 years</strong> ‚Äî tech, IP, M&amp;A recommended<br>‚Ä¢ <strong>5 years</strong> ‚Äî trade secrets, source code, algorithms<br>‚Ä¢ A defined term is safer for enforcement</p></details>
                        </div>
                        <div class="form-group">
                            <label>Governing Law</label>
                            <select id="governingLaw" onchange="toggleCustomGoverningLaw()">
                                <option value="partyA">Party A jurisdiction (default)</option>
                            </select>
                            <input type="text" id="governingLawCustom" class="hidden" style="margin-top:8px;" placeholder="e.g. Laws of the Republic of Singapore" />
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Controls which country's laws apply to this NDA<br>‚Ä¢ Defaults to Party A's jurisdiction<br>‚Ä¢ Best picks: England, New York, Singapore, Germany<br>‚Ä¢ Avoid jurisdictions where neither party operates</p></details>
                        </div>
                    </div>
                    <input type="hidden" id="bindOthers" value="Yes">
                    <hr class="form-divider">
                    <div class="form-group">
                        <label>Confidential Information Includes</label>
                        <details class="hint-wrap" style="margin-top:-2px;margin-bottom:6px;"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ More specific categories = stronger protection in disputes<br>‚Ä¢ Select all that apply to your deal<br>‚Ä¢ Add custom categories for deal-specific data<br>‚Ä¢ NDA also includes a catch-all for anything marked "confidential"</p></details>
                        <div class="checkbox-grid">
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="business plans and strategies" checked> <span>Business plans & strategies</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="financial information" checked> <span>Financial information</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="technical data and trade secrets" checked> <span>Technical data & trade secrets</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="customer and supplier lists"> <span>Customer & supplier lists</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="source code and algorithms"> <span>Source code & algorithms</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="marketing and sales data"> <span>Marketing & sales data</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="intellectual property"> <span>Intellectual property</span></label>
                            <label class="checkbox-card"><input type="checkbox" class="confInfo" value="personnel information"> <span>Personnel information</span></label>
                        </div>
                        <input type="text" id="confInfoCustom" style="margin-top:8px;" autocomplete="off" placeholder="Add your own categories (e.g. medical records, proprietary formulas)...">
                    </div>
                </div>
            </div>

            <!-- Generate -->
            <button class="btn-primary btn-hero" onclick="generateNDA()" id="generateBtn1">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                Generate Flash NDA
            </button>

            <!-- Loading State 1 -->
            <div id="loadingState1" class="card hidden">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Drafting your NDA...</div>
                </div>
            </div>

            <!-- Result 1 -->
            <div id="result1" class="hidden">
                <div class="nda-output-wrap">
                    <div class="nda-output-header">
                        <h3><span style="color:var(--green)">‚úì</span> Flash NDA Ready</h3>
                    </div>
                    <div id="ndaContent1" class="generated-nda"></div>
                    <div class="ai-disclaimer" style="margin:16px 0 12px 0;border-radius:10px;">
                        <span style="flex-shrink:0;font-size:1.1rem;margin-top:1px;">‚ö†Ô∏è</span>
                        <p><strong>AI-generated document.</strong> Large language models are probabilistic ‚Äî outputs may contain inaccuracies, omissions, or clauses that are not enforceable in your jurisdiction. This NDA is a starting point, not a finished legal instrument. To get a binding and enforceable agreement, <strong style="text-decoration:underline;cursor:not-allowed;opacity:0.7;">order a Legal Audit</strong> ‚Äî a qualified lawyer will review your NDA within 24 hours during business days for <strong>$100</strong>.</p>
                    </div>
                    <div class="nda-output-header" style="border-top:1px solid var(--border);padding-top:12px;">
                        <span></span>
                        <div class="nda-output-actions">
                            <button class="btn-secondary" onclick="copyText(generatedNDAText)">Copy</button>
                            <button class="btn-secondary" onclick="downloadPDF('ndaContent1', 'NDA.pdf')">PDF</button>
                        </div>
                    </div>
                </div>

                <!-- Strictness Meter -->
                <div id="strengthMeter1" class="strength-meter">
                    <div class="strength-header">
                        <span class="strength-title">NDA Strictness Score <span class="score-tip">‚ìò<span class="score-tip-text">Measures how restrictive your NDA is for the counterparty. Balanced is recommended for most deals ‚Äî aggressive terms may be unenforceable or discourage signing.</span></span></span>
                        <span id="strengthLabel1" class="strength-label">‚Äî</span>
                    </div>
                    <div class="strength-bar-bg">
                        <div id="strengthBar1" class="strength-bar-fill" style="width:0%;"></div>
                    </div>
                    <div class="strength-scale">
                        <span>Weak</span>
                        <span>Moderate</span>
                        <span style="display:flex;flex-direction:column;align-items:center;line-height:1.1;">Balanced<small style="font-size:0.6rem;color:var(--green);font-weight:600;">(Recommended)</small></span>
                        <span>Restrictive</span>
                        <span>Aggressive</span>
                    </div>
                    <div id="strengthBreakdown1" class="strength-breakdown"></div>

                    <div class="confidence-section">
                        <div class="strength-header">
                            <span class="strength-title">NDA Enforceability Score <span class="score-tip">‚ìò<span class="score-tip-text">Shows how likely your NDA is to hold up in court. AI-generated drafts cap at 50% ‚Äî use the Playbook to reach 70%, or get a Legal Audit for 100%.</span></span></span>
                            <span id="confLabel1" class="strength-label">‚Äî</span>
                        </div>
                        <div class="strength-bar-bg">
                            <div id="confBar1" class="strength-bar-fill" style="width:0%;"></div>
                        </div>
                        <div class="confidence-note" id="confNote1"></div>
                    </div>

                    <!-- Product Cards -->
                    <div class="product-cards-grid">
                        <div class="product-card product-card--playbook">
                            <div>
                                <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                                    <span style="font-size:1.3rem;">üìò</span>
                                    <span class="product-badge" style="color:var(--accent);background:var(--accent-soft);">Increase to 70%</span>
                                </div>
                                <h4 class="product-card-title">NDA Playbook in the AI Era</h4>
                                <p class="product-card-desc">The complete guide to NDA negotiation ‚Äî when to push back, which clauses to insist on, red flags to watch for, and clause-by-clause explanations with real-world examples.</p>
                            </div>
                            <div>
                                <span class="product-btn" style="background:var(--accent);">Get Playbook ‚Äî $10 <span style="font-size:0.68rem;opacity:0.8;font-weight:400;">(coming soon)</span></span>
                                <p class="product-meta">PDF ¬∑ 40+ pages</p>
                            </div>
                        </div>
                        <div class="product-card product-card--audit">
                            <div>
                                <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                                    <span style="font-size:1.3rem;">‚öñÔ∏è</span>
                                    <span class="product-badge" style="color:var(--green);background:var(--green-soft);">Achieve 100%</span>
                                </div>
                                <h4 class="product-card-title">Legal Audit by a Qualified Lawyer</h4>
                                <p class="product-card-desc">A lawyer reviews your NDA for enforceability, jurisdictional compliance, and missing protections. Delivered as a .docx ready for signing ‚Äî within one business day.</p>
                            </div>
                            <div>
                                <span class="product-btn" style="background:var(--green);">Order Legal Audit ‚Äî $100 <span style="font-size:0.68rem;opacity:0.8;font-weight:400;">(coming soon)</span></span>
                                <p class="product-meta">Includes formatted .docx ¬∑ 24h turnaround</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display:flex;gap:12px;margin-top:16px;">
                    <button class="btn-primary" style="flex:1;" onclick="navigateStep(2)">
                        Advanced Clauses ‚Üí
                    </button>
                    <button class="btn-secondary" onclick="navigateStep(3)" style="padding:14px 20px;">
                        Skip to Checklist
                    </button>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEP 2: Enhanced ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="step2" class="hidden space-y">
            <button class="btn-back" onclick="navigateStep(1)">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
                Back to Create Draft
            </button>

            <div class="info-banner">
                <strong>Step 2 (optional):</strong> Advanced clauses for experienced users ‚Äî compensation for breach, non-solicitation, non-compete, arbitration, and more.
            </div>

            <div class="card">
                <div class="card-title">Customize NDA</div>

                <div class="form-fields">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Residual Knowledge</label>
                            <select id="residualKnowledge">
                                <option value="Permitted">Permitted (standard)</option>
                                <option value="Restricted">Restricted (strict)</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ What people naturally remember after seeing confidential data<br>‚Ä¢ <strong>Permitted</strong> ‚Äî standard, fair for most deals<br>‚Ä¢ <strong>Restricted</strong> ‚Äî even mental impressions are protected. Use for sensitive IP/code reviews<br>‚Ä¢ Restricted = harder to enforce but stronger deterrent</p></details>
                        </div>
                        <div class="form-group">
                            <label>Return Materials Within</label>
                            <select id="returnDays">
                                <option value="10">10 days</option>
                                <option value="14" selected>14 days</option>
                                <option value="30">30 days</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Deadline to return or destroy all confidential materials<br>‚Ä¢ <strong>10 days</strong> ‚Äî aggressive, high-sensitivity<br>‚Ä¢ <strong>14 days</strong> ‚Äî standard practice<br>‚Ä¢ <strong>30 days</strong> ‚Äî complex IT systems/distributed teams<br>‚Ä¢ Regulatory-required copies may be retained</p></details>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Written Certification of Destruction</label>
                            <select id="writtenCert">
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Signed confirmation that all materials were destroyed/returned<br>‚Ä¢ Creates personal officer accountability<br>‚Ä¢ Standard for M&amp;A, investment rounds, VC/PE deals<br>‚Ä¢ "No" = return obligation exists but no formal certificate</p></details>
                        </div>
                        <div class="form-group">
                            <label>Restrict Professional Advisors</label>
                            <select id="restrictAdvisors">
                                <option value="No">No ‚Äî permitted (default from NDA)</option>
                                <option value="Yes">Yes ‚Äî require prior written consent</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ <strong>No (default)</strong> ‚Äî advisors access under their own duty of confidentiality. Standard.<br>‚Ä¢ <strong>Yes</strong> ‚Äî requires written consent before any advisor sees data<br>‚Ä¢ Use "Yes" for ultra-sensitive deals (hostile takeovers, pre-IPO)</p></details>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prohibit Public LLM / AI Uploads</label>
                            <select id="prohibitLLM">
                                <option value="Yes">Yes ‚Äî prohibit</option>
                                <option value="No">No</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Blocks uploading confidential data to AI tools (ChatGPT, Gemini, etc.)<br>‚Ä¢ AI services may use inputs for training or store on third-party servers<br>‚Ä¢ <strong>Recommended for all NDAs</strong> with source code, trade secrets, or financial data<br>‚Ä¢ Standard clause since 2023</p></details>
                        </div>
                        <div class="form-group">
                            <label>Notify Before Legal Disclosure</label>
                            <select id="notifyCompelled">
                                <option value="Yes">Yes (unless prohibited by court order)</option>
                                <option value="No">No</option>
                            </select>
                            <details class="hint-wrap"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Requires notification before disclosing data under court order/subpoena<br>‚Ä¢ Gives you time to seek a protective order<br>‚Ä¢ <strong>Yes (recommended)</strong> ‚Äî standard in all commercial NDAs<br>‚Ä¢ Exception: when court order itself prohibits notification</p></details>
                        </div>
                    </div>

                    <hr class="form-divider">
                    <label class="form-section-label">Non-Solicitation <span>(use sparingly)</span></label>
                    <details class="hint-wrap" style="margin-top:-2px;"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ Blocks recruiting/hiring each other's employees and clients<br>‚Ä¢ Use for consulting, outsourcing, JVs with close team contact<br>‚Ä¢ 12‚Äì24 months = generally enforceable<br>‚Ä¢ "Carve-out for public job postings" makes it more balanced</p></details>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Non-Solicitation</label>
                            <select id="prohibitSoliciting" onchange="toggleSolicitFields()">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>
                        <div class="form-group" id="solicitScopeGroup" style="display:none;">
                            <label>Scope</label>
                            <select id="solicitScope">
                                <option value="Employees">Employees only</option>
                                <option value="Employees+Contractors" selected>Employees + Contractors</option>
                                <option value="All+Clients">Employees + Contractors + Clients</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="solicitRow2" style="display:none;">
                        <div class="form-group">
                            <label>Non-Solicitation Duration</label>
                            <select id="solicitDuration">
                                <option value="12">12 months</option>
                                <option value="18">18 months</option>
                                <option value="24" selected>24 months</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Carve-out for Public Job Postings</label>
                            <select id="solicitCarveout">
                                <option value="Yes">Yes ‚Äî general ads excluded</option>
                                <option value="No">No ‚Äî all solicitation prohibited (not recommended ‚Äî may be unenforceable)</option>
                            </select>
                        </div>
                    </div>

                    <hr class="form-divider">
                    <label class="form-section-label">Non-Compete <span>(use sparingly)</span></label>
                    <details class="hint-wrap" style="margin-top:-2px;"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ <strong>‚ö† Use with extreme caution</strong> ‚Äî unusual in NDAs, often challenged<br>‚Ä¢ <strong>Void</strong> in California, Colorado, Minnesota, Oklahoma + restricted in EU<br>‚Ä¢ Works for M&amp;A, JVs, high-value IP deals<br>‚Ä¢ Keep short (6‚Äì12 months), narrow scope, adequate consideration<br>‚Ä¢ Overly broad = frequently struck down by courts</p></details>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Non-Compete</label>
                            <select id="nonCompete" onchange="toggleCompeteFields()">
                                <option value="No">No (recommended for NDA)</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>
                        <div class="form-group" id="competeDurationGroup" style="display:none;">
                            <label>Duration</label>
                            <select id="competeDuration">
                                <option value="6">6 months</option>
                                <option value="12" selected>12 months</option>
                                <option value="24">24 months</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="competeRow2" style="display:none;">
                        <div class="form-group">
                            <label>Geographic Scope</label>
                            <input type="text" id="competeGeo" placeholder="e.g. European Union, worldwide">
                        </div>
                        <div class="form-group">
                            <label>Industry / Activity Scope</label>
                            <input type="text" id="competeScope" placeholder="e.g. fintech payment processing">
                        </div>
                    </div>

                    <hr class="form-divider">
                    <label class="form-section-label">Compensation for Breach</label>
                    <details class="hint-wrap" style="margin-top:-2px;"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ <strong>Actual Damages</strong> ‚Äî must prove loss (default, can be hard)<br>‚Ä¢ <strong>Liquidated Damages</strong> ‚Äî pre-agreed amount, must be genuine estimate (common law: UK, US, SG, AU)<br>‚Ä¢ <strong>Contractual Penalty</strong> ‚Äî punitive, valid in civil law (DE, FR, PL, CZ, UAE)<br>‚Ä¢ ‚ö† Penalties are <strong>void</strong> in common law ‚Äî use liquidated damages instead<br>‚Ä¢ Proportional amounts are more enforceable</p></details>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Remedy Type</label>
                            <select id="breachRemedy" onchange="toggleBreachFields()">
                                <option value="Damages">Actual Damages Only (default)</option>
                                <option value="Liquidated">Liquidated Damages (common law)</option>
                                <option value="Penalty">Contractual Penalty (civil law only)</option>
                            </select>
                        </div>
                        <div class="form-group" id="breachAmountGroup" style="display:none;">
                            <label id="breachAmountLabel">Amount</label>
                            <div style="display:flex;gap:8px;">
                                <select id="breachCurrency" style="flex:0 0 90px;" onchange="toggleBreachCurrency()">
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                    <option value="CHF">CHF</option>
                                    <option value="AED">AED</option>
                                    <option value="PLN">PLN</option>
                                    <option value="CZK">CZK</option>
                                    <option value="custom">Other</option>
                                </select>
                                <input type="text" id="breachCurrencyCustom" class="hidden" style="flex:0 0 70px;" placeholder="e.g. SGD">
                                <input type="text" id="breachAmount" style="flex:1;" placeholder="e.g. 50,000">
                            </div>
                        </div>
                    </div>
                    <div id="breachWarning" class="hidden" style="font-size:0.78rem;color:var(--accent);margin-top:-8px;">
                        ‚ö† Penalty clauses are unenforceable in common law jurisdictions (UK, USA, Singapore, Hong Kong, Australia). Use liquidated damages instead.
                    </div>

                    <hr class="form-divider">
                    <label class="form-section-label">Dispute Resolution</label>
                    <details class="hint-wrap" style="margin-top:-2px;"><summary>‚ìò</summary><p class="field-hint">‚Ä¢ <strong>Courts</strong> ‚Äî simple, public, best for domestic deals<br>‚Ä¢ <strong>Arbitration</strong> ‚Äî private, enforceable in 170+ countries. Best for cross-border<br>‚Ä¢ <strong>Mediation then Arbitration</strong> ‚Äî negotiation step first, saves cost. Best for long-term relationships<br>‚Ä¢ Choose institution (ICC, LCIA, SIAC) matching your deal geography</p></details>
                    <div class="form-group">
                        <label>Dispute Resolution Method</label>
                        <select id="disputeMethod" onchange="toggleArbFields()">
                            <option value="Courts">Courts (default)</option>
                            <option value="Arbitration">Arbitration</option>
                            <option value="Mediation then Arbitration">Mediation then Arbitration</option>
                        </select>
                    </div>
                    <div id="arbFields" class="hidden" style="display:flex;flex-direction:column;gap:16px;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Arbitration Institution</label>
                                <select id="arbRules" onchange="onArbInstitutionChange()">
                                    <option value="ICC">ICC ‚Äî International Chamber of Commerce</option>
                                    <option value="LCIA">LCIA ‚Äî London Court of International Arbitration</option>
                                    <option value="AAA_ICDR">AAA/ICDR ‚Äî International Centre for Dispute Resolution</option>
                                    <option value="SIAC">SIAC ‚Äî Singapore International Arbitration Centre</option>
                                    <option value="SCC">SCC ‚Äî Stockholm Chamber of Commerce</option>
                                    <option value="DIAC">DIAC ‚Äî Dubai International Arbitration Centre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Seat of Arbitration</label>
                                <input type="text" id="arbLocation" placeholder="Auto-filled or enter manually">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Number of Arbitrators</label>
                                <select id="arbCount" onchange="updateArbClausePreview()">
                                    <option value="1" selected>Sole arbitrator (default)</option>
                                    <option value="3">Three arbitrators</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Arbitration Language</label>
                                <select id="arbLanguage">
                                    <option value="English">English</option>
                                    <option value="French">French</option>
                                    <option value="German">German</option>
                                    <option value="Spanish">Spanish</option>
                                    <option value="Arabic">Arabic</option>
                                    <option value="Russian">Russian</option>
                                </select>
                            </div>
                        </div>
                        <div id="arbClausePreview" style="padding: 14px 16px; background: var(--bg-warm); border: 1px solid var(--border-light); border-radius: 10px; font-size: 0.8rem; line-height: 1.65; color: var(--text-secondary); font-family: Georgia, 'Times New Roman', serif; display: none;">
                            <div style="font-family: 'Inter', sans-serif; font-size: 0.7rem; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px;">Model Clause Preview</div>
                            <div id="arbClauseText"></div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="generateEnhancedNDA()" id="generateBtn2">
                Generate Enhanced NDA
            </button>

            <div id="loadingState2" class="card hidden">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Enhancing your NDA with additional protections...</div>
                </div>
            </div>

            <div id="result2" class="hidden">
                <div class="nda-output-wrap">
                    <div class="nda-output-header">
                        <h3><span style="color:var(--green)">‚úì</span> Enhanced NDA Ready</h3>
                    </div>
                    <div id="ndaContent2" class="generated-nda"></div>
                    <div class="ai-disclaimer" style="margin:16px 0 12px 0;border-radius:10px;">
                        <span style="flex-shrink:0;font-size:1.1rem;margin-top:1px;">‚ö†Ô∏è</span>
                        <p><strong>AI-generated document.</strong> Large language models are probabilistic ‚Äî outputs may contain inaccuracies, omissions, or clauses that are not enforceable in your jurisdiction. This NDA is a starting point, not a finished legal instrument. To get a binding and enforceable agreement, <strong style="text-decoration:underline;cursor:not-allowed;opacity:0.7;">order a Legal Audit</strong> ‚Äî a qualified lawyer will review your NDA within 24 hours during business days for <strong>$100</strong>.</p>
                    </div>
                    <div class="nda-output-header" style="border-top:1px solid var(--border);padding-top:12px;">
                        <span></span>
                        <div class="nda-output-actions">
                            <button class="btn-secondary" onclick="copyText(generatedNDAText2)">Copy</button>
                            <button class="btn-secondary" onclick="downloadPDF('ndaContent2', 'NDA_Enhanced.pdf')">PDF</button>
                        </div>
                    </div>
                </div>

                <!-- Strictness Meter -->
                <div id="strengthMeter2" class="strength-meter">
                    <div class="strength-header">
                        <span class="strength-title">NDA Strictness Score <span class="score-tip">‚ìò<span class="score-tip-text">Measures how restrictive your NDA is for the counterparty. Balanced is recommended for most deals ‚Äî aggressive terms may be unenforceable or discourage signing.</span></span></span>
                        <span id="strengthLabel2" class="strength-label">‚Äî</span>
                    </div>
                    <div class="strength-bar-bg">
                        <div id="strengthBar2" class="strength-bar-fill" style="width:0%;"></div>
                    </div>
                    <div class="strength-scale">
                        <span>Weak</span>
                        <span>Moderate</span>
                        <span style="display:flex;flex-direction:column;align-items:center;line-height:1.1;">Balanced<small style="font-size:0.6rem;color:var(--green);font-weight:600;">(Recommended)</small></span>
                        <span>Restrictive</span>
                        <span>Aggressive</span>
                    </div>
                    <div id="strengthBreakdown2" class="strength-breakdown"></div>

                    <div class="confidence-section">
                        <div class="strength-header">
                            <span class="strength-title">NDA Enforceability Score <span class="score-tip">‚ìò<span class="score-tip-text">Shows how likely your NDA is to hold up in court. AI-generated drafts cap at 50% ‚Äî use the Playbook to reach 70%, or get a Legal Audit for 100%.</span></span></span>
                            <span id="confLabel2" class="strength-label">‚Äî</span>
                        </div>
                        <div class="strength-bar-bg">
                            <div id="confBar2" class="strength-bar-fill" style="width:0%;"></div>
                        </div>
                        <div class="confidence-note" id="confNote2"></div>
                    </div>

                    <!-- Product Cards -->
                    <div class="product-cards-grid">
                        <div class="product-card product-card--playbook">
                            <div>
                                <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                                    <span style="font-size:1.3rem;">üìò</span>
                                    <span class="product-badge" style="color:var(--accent);background:var(--accent-soft);">Increase to 70%</span>
                                </div>
                                <h4 class="product-card-title">NDA Playbook in the AI Era</h4>
                                <p class="product-card-desc">The complete guide to NDA negotiation ‚Äî when to push back, which clauses to insist on, red flags to watch for, and clause-by-clause explanations with real-world examples.</p>
                            </div>
                            <div>
                                <span class="product-btn" style="background:var(--accent);">Get Playbook ‚Äî $10 <span style="font-size:0.68rem;opacity:0.8;font-weight:400;">(coming soon)</span></span>
                                <p class="product-meta">PDF ¬∑ 40+ pages</p>
                            </div>
                        </div>
                        <div class="product-card product-card--audit">
                            <div>
                                <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                                    <span style="font-size:1.3rem;">‚öñÔ∏è</span>
                                    <span class="product-badge" style="color:var(--green);background:var(--green-soft);">Achieve 100%</span>
                                </div>
                                <h4 class="product-card-title">Legal Audit by a Qualified Lawyer</h4>
                                <p class="product-card-desc">A lawyer reviews your NDA for enforceability, jurisdictional compliance, and missing protections. Delivered as a .docx ready for signing ‚Äî within one business day.</p>
                            </div>
                            <div>
                                <span class="product-btn" style="background:var(--green);">Order Legal Audit ‚Äî $100 <span style="font-size:0.68rem;opacity:0.8;font-weight:400;">(coming soon)</span></span>
                                <p class="product-meta">Includes formatted .docx ¬∑ 24h turnaround</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" style="margin-top:16px;" onclick="navigateStep(3)">
                    NDA Checklist ‚Üí
                </button>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEP 3: NDA Checklist ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="step3" class="hidden space-y">
            <button class="btn-back" onclick="navigateStep(generatedNDAText2 ? 2 : 1)">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
                Back
            </button>

            <div class="info-banner">
                <strong>Step 3:</strong> Quick checks to confirm key terms before sharing your NDA.
            </div>

            <div class="card">
                <div class="card-title">Pre-Send Checklist</div>
                <div class="form-fields">
                    <div class="checklist" id="preSendChecklist">
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Party details verified</strong> ‚Äî legal names, registration numbers, and addresses match official records</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Signatory authority</strong> ‚Äî each signatory is authorised to bind their company (director, CEO, or holder of a power of attorney)</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Purpose matches the deal</strong> ‚Äî the stated purpose accurately describes what you're sharing information for</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>NDA type is correct</strong> ‚Äî Mutual if both sides share, Unilateral if only you disclose</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Confidentiality period is appropriate</strong> ‚Äî 2 years standard, 3‚Äì5 for trade secrets and IP</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Governing law is intentional</strong> ‚Äî matches the jurisdiction where you'd want to enforce the NDA</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Confidential info categories cover your data</strong> ‚Äî all sensitive material types are checked or added in the custom field</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Enhanced clauses reviewed</strong> ‚Äî if you added non-solicitation, non-compete, or penalties, confirm they're proportionate and enforceable in the governing jurisdiction</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Both signature blocks are complete</strong> ‚Äî signatory names, titles, and company details filled in</span></label>
                        <label class="checklist-item"><input type="checkbox" onchange="updateChecklistProgress()"><span><strong>Ready to send</strong> ‚Äî NDA attached as PDF, cover email reviewed, counterparty contact details confirmed</span></label>
                    </div>
                    <div id="checklistProgress" style="display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;background:var(--bg-warm);border:1px solid var(--border-light);">
                        <div style="flex:1;height:6px;border-radius:3px;background:var(--border-light);overflow:hidden;">
                            <div id="checklistBar" style="height:100%;width:0%;border-radius:3px;background:var(--accent);transition:width 0.3s ease;"></div>
                        </div>
                        <span id="checklistCount" style="font-size:0.78rem;font-weight:600;color:var(--text-muted);white-space:nowrap;">0 / 10</span>
                    </div>
                </div>
            </div>

            <div style="display:flex;gap:12px;">
                <button class="btn-primary" style="flex:1;" onclick="navigateStep(4)">
                    Lawyer Review ‚Üí
                </button>
                <button class="btn-secondary" onclick="navigateStep(5)" style="padding:14px 20px;">
                    Skip to Summary
                </button>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEP 4: Lawyer Review ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="step4" class="hidden space-y">
            <button class="btn-back" onclick="navigateStep(3)">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
                Back to Checklist
            </button>

            <div class="info-banner" style="background:linear-gradient(135deg, #F6FBF8 0%, #F0FAF4 100%);border-color:#C8E6D0;">
                <strong>Step 4 (Recommended):</strong> Get a real lawyer to review your NDA for enforceability and jurisdictional compliance ‚Äî within 24 hours.
            </div>

            <div class="card" style="border-color:#C8E6D0;background:linear-gradient(135deg, #FAFEFB 0%, #F5FBF7 100%);">
                <div style="text-align:center;padding:20px 0 10px;">
                    <span style="font-size:2.5rem;">‚öñÔ∏è</span>
                    <h3 style="font-size:1.15rem;font-weight:700;margin:12px 0 6px;">Legal Audit by a Qualified Lawyer</h3>
                    <span style="display:inline-block;font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.04em;color:var(--green);background:var(--green-soft);padding:4px 12px;border-radius:100px;">Achieve 100% Enforceability</span>
                </div>

                <div style="padding:0 8px 4px;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0;">
                        <div style="padding:14px;border-radius:10px;background:white;border:1px solid var(--border-light);">
                            <div style="font-size:0.7rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:6px;">What's included</div>
                            <p style="font-size:0.8rem;color:var(--text-secondary);line-height:1.6;">
                                ‚Ä¢ Full enforceability review<br>
                                ‚Ä¢ Jurisdictional compliance check<br>
                                ‚Ä¢ Missing protections analysis<br>
                                ‚Ä¢ Ready-to-sign .docx format
                            </p>
                        </div>
                        <div style="padding:14px;border-radius:10px;background:white;border:1px solid var(--border-light);">
                            <div style="font-size:0.7rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:6px;">Delivery</div>
                            <p style="font-size:0.8rem;color:var(--text-secondary);line-height:1.6;">
                                ‚Ä¢ Within 24 hours (business days)<br>
                                ‚Ä¢ Professionally formatted .docx<br>
                                ‚Ä¢ Lawyer's comments & notes<br>
                                ‚Ä¢ Unlimited follow-up questions
                            </p>
                        </div>
                    </div>

                    <div style="text-align:center;margin-bottom:16px;">
                        <span style="font-size:2rem;font-weight:700;color:var(--text);">$100</span>
                        <span style="font-size:0.82rem;color:var(--text-muted);margin-left:4px;">one-time</span>
                    </div>

                    <button class="btn-primary" style="background:var(--green);opacity:0.55;cursor:not-allowed;font-size:1rem;padding:16px;" disabled>
                        Order Legal Audit ‚Äî Coming Soon
                    </button>
                    <p style="text-align:center;font-size:0.68rem;color:var(--text-muted);margin-top:8px;">We're finalizing the process. Leave your email to be notified when it's available.</p>
                </div>
            </div>

            <div style="display:flex;gap:12px;margin-top:4px;">
                <button class="btn-primary" style="flex:1;" onclick="navigateStep(5)">
                    Final Summary ‚Üí
                </button>
                <button class="btn-secondary" onclick="navigateStep(6)" style="padding:14px 20px;">
                    Skip to Send
                </button>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEP 5: Final Summary ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="step5" class="hidden space-y">
            <button class="btn-back" onclick="navigateStep(4)">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
                Back
            </button>

            <div class="info-banner">
                <strong>Step 5:</strong> Generate a friendly summary to share with the counterparty. They'll understand the key terms without legal jargon.
            </div>

            <div class="card">
                <p style="color:var(--text-secondary);margin-bottom:14px;">
                    This will explain the <strong id="summarySource">Flash NDA</strong> in simple terms for the other party.
                </p>
                <button class="btn-primary" onclick="generateSummary()" id="generateBtn3">
                    Generate Plain-English Summary
                </button>
            </div>

            <div id="loadingState3" class="card hidden">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Creating plain-English summary...</div>
                </div>
            </div>

            <div id="result3" class="hidden">
                <div class="nda-output-wrap">
                    <div class="nda-output-header">
                        <h3><span style="color:var(--green)">‚úì</span> Summary Ready</h3>
                        <div class="nda-output-actions">
                            <button class="btn-secondary" onclick="copyText(generatedSummaryText)">Copy</button>
                            <button class="btn-secondary" onclick="downloadPDF('summaryContent', 'NDA_Summary.pdf')">PDF</button>
                        </div>
                    </div>
                    <div id="summaryContent" class="summary-content"></div>
                    <div class="nda-output-header" style="border-top:1px solid var(--border);margin-top:16px;padding-top:12px;">
                        <span></span>
                        <div class="nda-output-actions">
                            <button class="btn-secondary" onclick="copyText(generatedSummaryText)">Copy</button>
                            <button class="btn-secondary" onclick="downloadPDF('summaryContent', 'NDA_Summary.pdf')">PDF</button>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" style="margin-top:16px;" onclick="navigateStep(6)">
                    Send NDA ‚Üí
                </button>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEP 6: Send NDA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="step6" class="hidden space-y">
            <button class="btn-back" onclick="navigateStep(5)">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
                Back
            </button>

            <div class="info-banner">
                <strong>Step 6:</strong> Copy the pre-filled cover email to send your NDA professionally.
            </div>

            <div class="card">
                <div class="card-title">Cover Email</div>
                <div class="form-fields">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Send to</label>
                            <select id="emailRecipient" onchange="buildEmailTemplate()">
                                <option value="B">Party B ‚Äî Receiving Party</option>
                                <option value="A">Party A ‚Äî Disclosing Party</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Recipient Email</label>
                            <input type="email" id="emailTo" autocomplete="off" placeholder="contact@company.com" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="font-size:0.78rem;color:var(--text-muted);font-weight:600;">Subject</label>
                        <input type="text" id="emailSubject" style="margin-top:4px;" />
                    </div>
                    <div class="form-group">
                        <label style="font-size:0.78rem;color:var(--text-muted);font-weight:600;">Email Body</label>
                        <textarea id="emailBody" style="margin-top:4px;min-height:280px;line-height:1.7;"></textarea>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button class="btn-primary" onclick="copyEmailText()" style="flex:1;">
                            Copy Email
                        </button>
                        <button class="btn-secondary" onclick="openInMailClient()" style="flex:0 0 auto;">
                            Open in Mail
                        </button>
                    </div>
                    <div id="emailCopied" class="hidden" style="text-align:center;padding:8px;color:var(--green);font-size:0.85rem;font-weight:600;">
                        ‚úì Copied to clipboard
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Persistent Blocks (visible after first NDA) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="persistentBlocks" class="hidden" style="margin-top:24px;">

            <!-- Documents Panel -->
            <div id="docsPanel" class="docs-panel" style="margin-bottom:16px;">
                <div class="docs-panel-title">üìÑ Your Documents</div>
                <div id="docsList" class="docs-list"></div>
            </div>

            <button class="btn-secondary" style="width:100%;" onclick="navigateStep(1)">
                ‚Üê Create Another NDA
            </button>
        </div>
    </main>

    <!-- Testimonials -->
    <section class="testimonials-section">
        <div class="testimonials-inner">
            <h3 class="testimonials-title">What people say</h3>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p class="testimonial-text">"Clean UX, solid AI drafts, and a real legal review option. Exactly what founders need ‚Äî from draft to signed NDA in minutes."</p>
                    <div class="testimonial-author">
                        <img src="https://framerusercontent.com/images/mvtP8dMNAZzBsxA3cFkzeSugA.png?width=72&height=72" alt="Brandson" class="testimonial-logo" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';" />
                        <div class="testimonial-avatar" style="display:none;">B</div>
                        <div>
                            <div class="testimonial-name">Brandson Digital Studio</div>
                            <div class="testimonial-role">Digital design partner ¬∑ <a href="https://www.brandson.digital/" target="_blank" rel="noopener">brandson.digital</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Legal Disclaimer -->
    <div class="legal-disclaimer-bar">
        <p><strong>Legal disclaimer.</strong> This tool generates NDA drafts using AI and does not constitute legal advice. No attorney-client relationship is created. Consult a qualified lawyer before using.</p>
    </div>

    <footer>
        <div class="footer-inner">
            <div>
                <p style="font-weight:600;color:var(--text);font-size:0.85rem;">‚ö° Flash NDA Drafter</p>
                <p style="margin-top:2px;">AI-powered drafter, built by lawyers</p>
            </div>
            <div style="display:flex;gap:16px;">
                <a href="mailto:hello@sblc.com.ua">hello@sblc.com.ua</a>
                <a href="https://sblc.com.ua" target="_blank">sblc.com.ua</a>
            </div>
        </div>
    </footer>

    <script>
        let generatedNDAText = '';
        let generatedNDAText2 = '';
        let generatedSummaryText = '';
        let searchTimeout = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Save/Load Party Data ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function savePartyData(party) {
            const data = {
                name: document.getElementById(`party${party}Name`).value,
                type: document.getElementById(`party${party}Type`).value,
                companyNumber: document.getElementById(`party${party}CompanyNumber`).value,
                address: document.getElementById(`party${party}Address`).value,
                email: document.getElementById(`party${party}Email`).value,
                signatory: document.getElementById(`party${party}Signatory`).value,
                title: document.getElementById(`party${party}Title`).value,
            };
            localStorage.setItem(`nda_party${party}`, JSON.stringify(data));
        }
        function loadPartyData(party) {
            const saved = localStorage.getItem(`nda_party${party}`);
            if (saved) {
                const data = JSON.parse(saved);
                if (data.name) document.getElementById(`party${party}Name`).value = data.name;
                if (data.type) document.getElementById(`party${party}Type`).value = data.type;
                if (data.companyNumber) document.getElementById(`party${party}CompanyNumber`).value = data.companyNumber;
                if (data.address) document.getElementById(`party${party}Address`).value = data.address;
                if (data.email) document.getElementById(`party${party}Email`).value = data.email;
                if (data.signatory) document.getElementById(`party${party}Signatory`).value = data.signatory;
                if (data.title) document.getElementById(`party${party}Title`).value = data.title;
            }
        }
        function saveToHistory(party, name, address, email, type, companyNumber, signatory, title) {
            if (!name) return;
            let history = JSON.parse(localStorage.getItem('nda_history') || '[]');
            history = history.filter(h => h.name !== name);
            history.unshift({ party, name, address, email, type, companyNumber, signatory, title, date: new Date().toISOString() });
            history = history.slice(0, 20);
            localStorage.setItem('nda_history', JSON.stringify(history));
            populateHistoryDropdowns();
        }
        function populateHistoryDropdowns() {
            const history = JSON.parse(localStorage.getItem('nda_history') || '[]');
            ['A', 'B'].forEach(party => {
                const sel = document.getElementById(`history${party}`);
                sel.innerHTML = '<option value="">Select previous entry...</option>';
                history.forEach((h, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = `${h.name}${h.address ? ' ‚Äî ' + h.address.substring(0,30) + '...' : ''}`;
                    sel.appendChild(opt);
                });
            });
        }
        function loadFromHistory(party, index) {
            if (index === '') return;
            const history = JSON.parse(localStorage.getItem('nda_history') || '[]');
            const h = history[index];
            if (h) {
                document.getElementById(`party${party}Name`).value = h.name || '';
                document.getElementById(`party${party}Type`).value = h.type || 'Company';
                document.getElementById(`party${party}CompanyNumber`).value = h.companyNumber || '';
                document.getElementById(`party${party}Address`).value = h.address || '';
                document.getElementById(`party${party}Email`).value = h.email || '';
                document.getElementById(`party${party}Signatory`).value = h.signatory || '';
                document.getElementById(`party${party}Title`).value = h.title || '';
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Fill Mode Tabs ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function toggleCustomPurpose() {
            const sel = document.getElementById('purposeSelect');
            const custom = document.getElementById('purposeCustom');
            if (sel.value === 'custom') {
                custom.classList.remove('hidden');
                custom.focus();
            } else {
                custom.classList.add('hidden');
            }
        }

        function toggleCustomRole() {
            const sel = document.getElementById('partyBRole');
            const custom = document.getElementById('partyBRoleCustom');
            if (sel.value === 'custom') {
                custom.classList.remove('hidden');
                custom.focus();
            } else {
                custom.classList.add('hidden');
            }
        }

        function getPartyBRole() {
            const sel = document.getElementById('partyBRole');
            if (sel.value === 'custom') {
                return document.getElementById('partyBRoleCustom').value || 'Counterparty';
            }
            return sel.value;
        }

        function getPurpose() {
            const sel = document.getElementById('purposeSelect');
            if (sel.value === 'custom') {
                return document.getElementById('purposeCustom').value || 'To evaluate and pursue a potential business relationship between the Parties.';
            }
            return sel.value;
        }

        function setFillMode(party, mode, btn) {
            document.querySelectorAll(`#fillTabs${party} .fill-tab`).forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll(`[id^="fill${party}-"]`).forEach(el => el.classList.add('hidden'));
            document.getElementById(`fill${party}-${mode}`).classList.remove('hidden');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Company Search ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // Server-side: UK Companies House, Czech ARES, OpenCorporates
        // Manual links: Estonia, Lithuania, Poland (no free server API available)
        const REGISTER_LINKS = [
            { name: 'Estonia üá™üá™', url: 'https://ariregister.rik.ee/eng/company_search' },
            { name: 'Lithuania üá±üáπ', url: 'https://www.registrucentras.lt/jar/p_en/' },
            { name: 'Poland üáµüá±', url: 'https://wyszukiwarka-krs.ms.gov.pl/' },
            { name: 'Singapore üá∏üá¨', url: 'https://www.acra.gov.sg/how-to-guides/before-you-start/check-company-name' },
            { name: 'USA üá∫üá∏', url: 'https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany' },
        ];

        function searchCompany(party, query) {
            const dropdown = document.getElementById(`dropdown${party}`);
            clearTimeout(searchTimeout);
            if (query.length < 2) { dropdown.classList.add('hidden'); return; }

            dropdown.innerHTML = '<div class="ac-loading"><span class="spinner"></span>Searching registers...</div>';
            dropdown.classList.remove('hidden');

            searchTimeout = setTimeout(async () => {
                try {
                    const res = await fetch('/.netlify/functions/search-company', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query })
                    });
                    const data = await safeJson(res);
                    const results = data.results || [];

                    if (results.length > 0) {
                        dropdown.innerHTML = results.map(r => `
                            <div class="autocomplete-item" onclick='selectCompany("${party}", ${JSON.stringify(r).replace(/'/g, "&#39;")})'>
                                <div class="ac-name">${escapeHtml(r.name)}</div>
                                <div class="ac-meta">
                                    ${r.companyNumber ? `<span class="ac-tag code">${escapeHtml(r.companyNumber)}</span>` : ''}
                                    ${r.jurisdiction ? `<span class="ac-tag jurisdiction">${escapeHtml(r.jurisdiction)}</span>` : ''}
                                    ${r.status ? `<span class="ac-tag status">${escapeHtml(r.status)}</span>` : ''}
                                    ${r.address ? '<span class="ac-tag address-ok">Address ‚úì</span>' : '<span class="ac-tag address-missing">No address</span>'}
                                    <span class="ac-tag source">${escapeHtml(r.source)}</span>
                                </div>
                                ${r.address ? `<div class="ac-address">${escapeHtml(r.address)}</div>` : ''}
                            </div>
                        `).join('');
                    } else {
                        dropdown.innerHTML = '<div class="ac-loading">No results found</div>';
                    }

                    // Always show manual register links at bottom
                    const linksHtml = REGISTER_LINKS.map(r =>
                        `<a href="${r.url}" target="_blank" rel="noopener" style="color:var(--primary);text-decoration:none;font-size:0.8rem;white-space:nowrap;">${r.name}</a>`
                    ).join(' ¬∑ ');
                    dropdown.innerHTML += `<div style="padding:8px 12px;border-top:1px solid var(--border);font-size:0.78rem;color:var(--text-muted);">Search manually: ${linksHtml}</div>`;

                    if (data.warning) {
                        dropdown.innerHTML += `<div class="ac-loading" style="font-size:0.75rem;color:var(--text-muted);">${escapeHtml(data.warning)}</div>`;
                    }
                } catch (e) {
                    dropdown.innerHTML = '<div class="ac-loading">Search error. Try again.</div>';
                }
            }, 400);
        }

        function selectCompany(party, company) {
            document.getElementById(`party${party}Name`).value = company.name || '';
            document.getElementById(`party${party}CompanyNumber`).value = company.companyNumber || '';
            document.getElementById(`party${party}Address`).value = company.address || '';
            if (company.companyType) {
                const typeMap = {
                    'ltd': 'LTD', 'private-limited-guarant-nsc': 'LTD', 'plc': 'Corporation', 'llp': 'Partnership',
                    'o√º': 'LTD', 'as': 'Corporation', 'fie': 'Individual', 'mt√º': 'Company', 'sa': 'Company',
                    's.r.o.': 'LTD', 'a.s.': 'Corporation', 'v.o.s.': 'Partnership', 'k.s.': 'Partnership',
                };
                const mapped = typeMap[(company.companyType || '').toLowerCase()];
                if (mapped) document.getElementById(`party${party}Type`).value = mapped;
            }
            document.getElementById(`dropdown${party}`).classList.add('hidden');
            document.getElementById(`search${party}`).value = '';
            updateGoverningLawOptions();
        }

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Website / Email / Card Parsing ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        async function parseWebsite(party) {
            const url = document.getElementById(`website${party}`).value;
            if (!url) return alert('Enter a website URL');
            const btn = event.target;
            btn.textContent = 'Fetching...';
            btn.disabled = true;
            try {
                const res = await fetch('/.netlify/functions/parse-company', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url.startsWith('http') ? url : 'https://' + url })
                });
                const data = await safeJson(res);
                if (!res.ok) throw new Error(data.error || 'Failed to fetch');
                if (data.name) document.getElementById(`party${party}Name`).value = data.name;
                // Backend returns "addresses" array, take the first one
                const addr = data.address || (Array.isArray(data.addresses) && data.addresses[0]) || '';
                if (addr) document.getElementById(`party${party}Address`).value = addr;
                if (data.email) document.getElementById(`party${party}Email`).value = data.email;
                updateGoverningLawOptions();
                if (!data.name && !addr && !data.email) {
                    alert('Could not extract company info from this website. Try the contact page URL directly.');
                }
            } catch (e) { alert('Failed to parse website: ' + e.message); }
            finally { btn.textContent = 'Fetch'; btn.disabled = false; }
        }

        async function parseEmail(party) {
            const email = document.getElementById(`emailFill${party}`).value;
            if (!email || !email.includes('@')) return alert('Enter a valid email');
            const domain = email.split('@')[1];
            document.getElementById(`party${party}Email`).value = email;
            const btn = event.target;
            btn.textContent = 'Fetching...';
            btn.disabled = true;
            try {
                const res = await fetch('/.netlify/functions/parse-company', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: `https://${domain}` })
                });
                const data = await safeJson(res);
                if (data.name) document.getElementById(`party${party}Name`).value = data.name;
                const addr = data.address || (Array.isArray(data.addresses) && data.addresses[0]) || '';
                if (addr) document.getElementById(`party${party}Address`).value = addr;
                updateGoverningLawOptions();
            } catch (e) { /* silently fail */ }
            finally { btn.textContent = 'Fetch'; btn.disabled = false; }
        }

        async function parseCard(party) {
            const file = document.getElementById(`card${party}`).files[0];
            if (!file) return alert('Select an image of a business card');
            const reader = new FileReader();
            reader.onload = async () => {
                try {
                    const res = await fetch('/.netlify/functions/parse-card', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ image: reader.result })
                    });
                    const data = await safeJson(res);
                    // Card returns: { name: "Person", company: "Company", title: "CEO", email, phone, address }
                    if (data.company) document.getElementById(`party${party}Name`).value = data.company;
                    else if (data.name) document.getElementById(`party${party}Name`).value = data.name;
                    if (data.address) document.getElementById(`party${party}Address`).value = data.address;
                    if (data.email) document.getElementById(`party${party}Email`).value = data.email;
                    if (data.name) document.getElementById(`party${party}Signatory`).value = data.name;
                    if (data.title) document.getElementById(`party${party}Title`).value = data.title;
                    updateGoverningLawOptions();
                } catch (e) { alert('Failed to parse card'); }
            };
            reader.readAsDataURL(file);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Governing Law ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function getGoverningLaw() {
            const sel = document.getElementById('governingLaw');
            if (sel.value === 'custom') {
                return document.getElementById('governingLawCustom').value.trim();
            }
            if (sel.value === 'partyA' || !sel.value) {
                // Default: detect from Party A address
                const addrA = document.getElementById('partyAAddress').value;
                const jurA = detectJurisdictionFromAddress(addrA);
                if (jurA) return jurA;
                // Fallback: try Party B
                const addrB = document.getElementById('partyBAddress').value;
                const jurB = detectJurisdictionFromAddress(addrB);
                return jurB || '';
            }
            return sel.value;
        }

        function detectJurisdictionFromAddress(address) {
            if (!address) return null;
            const addr = address.toLowerCase();
            const map = {
                // ‚îÄ‚îÄ UK ‚îÄ‚îÄ
                'England and Wales': ['england', 'wales', 'london', 'manchester', 'birmingham', 'liverpool', 'leeds', 'bristol', 'nottingham', 'sheffield', 'leicester', 'coventry', 'oxford', 'cambridge', 'southampton', 'newcastle upon tyne', 'brighton'],
                'Scotland': ['scotland', 'edinburgh', 'glasgow', 'aberdeen', 'dundee'],
                'Northern Ireland': ['northern ireland', 'belfast'],
                // ‚îÄ‚îÄ USA ‚îÄ‚îÄ
                'Delaware, USA': ['delaware', 'wilmington, de', ', de 19'],
                'State of New York, USA': ['new york', ', ny '],
                'State of California, USA': ['california', 'san francisco', 'los angeles', 'san diego', 'san jose', 'silicon valley', 'palo alto', 'mountain view', ', ca '],
                'State of Texas, USA': ['texas', 'houston', 'austin, tx', 'dallas', 'san antonio', 'fort worth', ', tx '],
                'State of Florida, USA': ['florida', 'miami', 'orlando', 'tampa', 'jacksonville', ', fl '],
                'State of Illinois, USA': ['illinois', 'chicago', ', il '],
                'State of Washington, USA': ['seattle', 'washington state', ', wa 9'],
                'State of Massachusetts, USA': ['massachusetts', 'boston', ', ma 0'],
                'State of Colorado, USA': ['colorado', 'denver', ', co 8'],
                'State of Georgia, USA': ['atlanta', ', ga 3'],
                'State of Wyoming, USA': ['wyoming', 'cheyenne, wy', ', wy 8'],
                'State of Nevada, USA': ['nevada', 'las vegas', 'reno, nv', ', nv 8'],
                // ‚îÄ‚îÄ Canada ‚îÄ‚îÄ
                'Province of Ontario, Canada': ['ontario', 'toronto', 'ottawa'],
                'Province of British Columbia, Canada': ['british columbia', 'vancouver'],
                'Province of Quebec, Canada': ['quebec', 'montreal', 'qu√©bec'],
                'Province of Alberta, Canada': ['alberta', 'calgary', 'edmonton'],
                // ‚îÄ‚îÄ EU: Iberia ‚îÄ‚îÄ
                'Republic of Portugal': ['portugal', 'lisbon', 'lisboa', 'porto', 'braga', 'funchal', 'faro', 'coimbra', 'aveiro'],
                'Kingdom of Spain': ['spain', 'espa√±a', 'madrid', 'barcelona', 'valencia', 'seville', 'sevilla', 'malaga', 'm√°laga', 'bilbao', 'zaragoza', 'alicante', 'las palmas'],
                // ‚îÄ‚îÄ EU: Western ‚îÄ‚îÄ
                'France': ['france', 'paris', 'lyon', 'marseille', 'nice', 'toulouse', 'bordeaux', 'nantes', 'strasbourg', 'lille', 'montpellier'],
                'Kingdom of Belgium': ['belgium', 'belgique', 'brussels', 'bruxelles', 'antwerp', 'antwerpen', 'ghent', 'gent', 'li√®ge'],
                'The Netherlands': ['netherlands', 'nederland', 'amsterdam', 'rotterdam', 'the hague', 'den haag', 'eindhoven', 'utrecht', 'tilburg', 'groningen'],
                'Grand Duchy of Luxembourg': ['luxembourg', 'luxemburg'],
                'Republic of Ireland': ['ireland', 'dublin', 'cork', 'galway', 'limerick', 'waterford'],
                // ‚îÄ‚îÄ EU: DACH ‚îÄ‚îÄ
                'Germany': ['germany', 'deutschland', 'berlin', 'munich', 'm√ºnchen', 'frankfurt', 'hamburg', 'd√ºsseldorf', 'dusseldorf', 'cologne', 'k√∂ln', 'stuttgart', 'dortmund', 'essen', 'leipzig', 'bremen', 'dresden', 'hannover', 'n√ºrnberg', 'nuremberg'],
                'Republic of Austria': ['austria', '√∂sterreich', 'vienna', 'wien', 'salzburg', 'graz', 'innsbruck', 'linz', 'klagenfurt'],
                'Switzerland': ['switzerland', 'schweiz', 'suisse', 'zurich', 'z√ºrich', 'geneva', 'gen√®ve', 'bern', 'basel', 'lausanne', 'lucerne', 'luzern', 'lugano'],
                'Principality of Liechtenstein': ['liechtenstein', 'vaduz'],
                // ‚îÄ‚îÄ EU: Nordics ‚îÄ‚îÄ
                'Kingdom of Denmark': ['denmark', 'danmark', 'copenhagen', 'k√∏benhavn', 'aarhus', 'odense'],
                'Kingdom of Sweden': ['sweden', 'sverige', 'stockholm', 'gothenburg', 'g√∂teborg', 'malm√∂', 'uppsala'],
                'Republic of Finland': ['finland', 'suomi', 'helsinki', 'espoo', 'tampere', 'turku', 'oulu'],
                'Kingdom of Norway': ['norway', 'norge', 'oslo', 'bergen', 'trondheim', 'stavanger'],
                'Republic of Iceland': ['iceland', '√≠sland', 'reykjavik', 'reykjav√≠k'],
                // ‚îÄ‚îÄ EU: Baltics ‚îÄ‚îÄ
                'Republic of Estonia': ['estonia', 'eesti', 'tallinn', 'tartu', 'p√§rnu', 'narva'],
                'Republic of Latvia': ['latvia', 'latvija', 'riga', 'daugavpils', 'liepaja', 'liepƒÅja', 'j≈´rmala'],
                'Republic of Lithuania': ['lithuania', 'lietuva', 'vilnius', 'kaunas', 'klaipeda', 'klaipƒóda', '≈°iauliai'],
                // ‚îÄ‚îÄ EU: Central ‚îÄ‚îÄ
                'Republic of Poland': ['poland', 'polska', 'warsaw', 'warszawa', 'krak√≥w', 'krakow', 'wroclaw', 'wroc≈Çaw', 'gdansk', 'gda≈Ñsk', 'poznan', 'pozna≈Ñ', '≈Ç√≥d≈∫', 'lodz', 'katowice', 'lublin', 'szczecin'],
                'Czech Republic': ['czech', 'ƒçesko', 'prague', 'praha', 'brno', 'ostrava', 'plze≈à', 'plzen', 'olomouc', 'liberec'],
                'Slovak Republic': ['slovakia', 'slovensko', 'bratislava', 'ko≈°ice', 'kosice', 'pre≈°ov', '≈æilina', 'nitra'],
                'Hungary': ['hungary', 'magyarorsz√°g', 'budapest', 'debrecen', 'szeged', 'miskolc', 'p√©cs'],
                'Republic of Slovenia': ['slovenia', 'slovenija', 'ljubljana', 'maribor'],
                // ‚îÄ‚îÄ EU: Southeast ‚îÄ‚îÄ
                'Republic of Italy': ['italy', 'italia', 'rome', 'roma', 'milan', 'milano', 'naples', 'napoli', 'turin', 'torino', 'florence', 'firenze', 'bologna', 'genoa', 'genova', 'palermo', 'venice', 'venezia', 'bari', 'verona'],
                'Republic of Greece': ['greece', 'ŒµŒªŒªŒ¨Œ¥Œ±', 'athens', 'athina', 'thessaloniki', 'patras', 'heraklion', 'larissa'],
                'Republic of Cyprus': ['cyprus', 'Œ∫œçœÄœÅŒøœÇ', 'nicosia', 'limassol', 'larnaca', 'paphos', 'lefkosia', 'lemesos'],
                'Republic of Malta': ['malta', 'valletta', 'sliema', 'st. julian'],
                'Republic of Croatia': ['croatia', 'hrvatska', 'zagreb', 'split', 'dubrovnik', 'rijeka', 'osijek'],
                'Romania': ['romania', 'rom√¢nia', 'bucharest', 'bucure»ôti', 'cluj', 'timi»ôoara', 'timisoara', 'ia»ôi', 'iasi', 'constan»õa', 'brasov', 'bra»ôov'],
                'Republic of Bulgaria': ['bulgaria', '–±—ä–ª–≥–∞—Ä–∏—è', 'sofia', 'plovdiv', 'varna', 'burgas'],
                // ‚îÄ‚îÄ Balkans (non-EU) ‚îÄ‚îÄ
                'Republic of Serbia': ['serbia', 'srbija', 'belgrade', 'beograd', 'novi sad'],
                'Montenegro': ['montenegro', 'crna gora', 'podgorica', 'budva'],
                'Republic of North Macedonia': ['north macedonia', 'skopje', 'bitola'],
                'Republic of Albania': ['albania', 'tirana', 'tiran√´', 'durr√´s'],
                'Bosnia and Herzegovina': ['bosnia', 'hercegovina', 'sarajevo', 'banja luka'],
                'Republic of Kosovo': ['kosovo', 'pristina', 'prishtina'],
                // ‚îÄ‚îÄ Eastern Europe / CIS ‚îÄ‚îÄ
                'Ukraine': ['ukraine', '—É–∫—Ä–∞—ó–Ω–∞', 'kyiv', 'kiev', 'kharkiv', 'odesa', 'odessa', 'dnipro', 'lviv'],
                'Republic of Georgia': ['tbilisi', 'batumi', 'kutaisi'],
                'Republic of Moldova': ['moldova', 'chi»ôinƒÉu', 'chisinau'],
                'Republic of Armenia': ['armenia', 'yerevan'],
                'Republic of Azerbaijan': ['azerbaijan', 'baku'],
                'Republic of Belarus': ['belarus', 'minsk'],
                'Republic of Turkey': ['turkey', 't√ºrkiye', 'istanbul', 'ankara', 'izmir', 'antalya', 'bursa'],
                'Russian Federation': ['russia', '–º–æ—Å–∫–≤–∞', 'moscow', 'saint petersburg'],
                // ‚îÄ‚îÄ Central Asia ‚îÄ‚îÄ
                'Republic of Kazakhstan': ['kazakhstan', 'almaty', 'astana', 'nur-sultan'],
                'Republic of Uzbekistan': ['uzbekistan', 'tashkent'],
                'Kyrgyz Republic': ['kyrgyzstan', 'bishkek'],
                'Republic of Tajikistan': ['tajikistan', 'dushanbe'],
                'Turkmenistan': ['turkmenistan', 'ashgabat'],
                // ‚îÄ‚îÄ Middle East ‚îÄ‚îÄ
                'UAE Federal Law': ['united arab emirates', 'uae', 'emirates', 'sharjah', 'ajman', 'ras al khaimah', 'fujairah', 'umm al quwain'],
                'Emirate of Dubai': ['dubai'],
                'Emirate of Abu Dhabi': ['abu dhabi'],
                'DIFC Law': ['difc', 'dubai international financial centre'],
                'ADGM Law': ['adgm', 'abu dhabi global market'],
                'Kingdom of Saudi Arabia': ['saudi arabia', 'riyadh', 'jeddah', 'mecca', 'medina', 'dammam'],
                'Kingdom of Bahrain': ['bahrain', 'manama'],
                'State of Qatar': ['qatar', 'doha'],
                'Sultanate of Oman': ['oman', 'muscat'],
                'State of Kuwait': ['kuwait'],
                'Hashemite Kingdom of Jordan': ['jordan', 'amman'],
                'Republic of Lebanon': ['lebanon', 'beirut'],
                'State of Israel': ['israel', 'tel aviv', 'jerusalem', 'haifa', 'herzliya'],
                'Republic of Iraq': ['iraq', 'baghdad', 'erbil'],
                'Islamic Republic of Iran': ['iran', 'tehran'],
                // ‚îÄ‚îÄ South Asia ‚îÄ‚îÄ
                'Republic of India': ['india', 'mumbai', 'delhi', 'new delhi', 'bangalore', 'bengaluru', 'hyderabad', 'chennai', 'kolkata', 'pune', 'ahmedabad', 'gurugram', 'gurgaon', 'noida'],
                'Islamic Republic of Pakistan': ['pakistan', 'karachi', 'lahore', 'islamabad'],
                'Republic of Bangladesh': ['bangladesh', 'dhaka', 'chittagong'],
                'Democratic Socialist Republic of Sri Lanka': ['sri lanka', 'colombo'],
                'Federal Democratic Republic of Nepal': ['nepal', 'kathmandu'],
                // ‚îÄ‚îÄ East Asia ‚îÄ‚îÄ
                "People's Republic of China": ['china', 'beijing', 'shanghai', 'shenzhen', 'guangzhou', 'hangzhou', 'chengdu', 'nanjing', 'wuhan', 'tianjin', 'suzhou', 'xiamen'],
                'Japan': ['japan', 'tokyo', 'osaka', 'yokohama', 'nagoya', 'kyoto', 'fukuoka', 'sapporo', 'kobe'],
                'Republic of Korea': ['south korea', 'seoul', 'busan', 'incheon', 'daegu'],
                'Republic of China (Taiwan)': ['taiwan', 'taipei'],
                'Mongolia': ['mongolia', 'ulaanbaatar'],
                // ‚îÄ‚îÄ Southeast Asia ‚îÄ‚îÄ
                'Singapore': ['singapore'],
                'Hong Kong': ['hong kong'],
                'Macau': ['macau', 'macao'],
                'Kingdom of Thailand': ['thailand', 'bangkok', 'chiang mai', 'phuket', 'pattaya'],
                'Socialist Republic of Vietnam': ['vietnam', 'viet nam', 'ho chi minh', 'hanoi'],
                'Republic of Indonesia': ['indonesia', 'jakarta', 'bali', 'surabaya', 'bandung'],
                'Malaysia': ['malaysia', 'kuala lumpur', 'penang', 'johor bahru', 'labuan'],
                'Republic of the Philippines': ['philippines', 'manila', 'makati', 'cebu', 'quezon city'],
                'Kingdom of Cambodia': ['cambodia', 'phnom penh', 'siem reap'],
                "Lao People's Democratic Republic": ['laos', 'vientiane'],
                'Republic of the Union of Myanmar': ['myanmar', 'yangon', 'naypyidaw'],
                'Brunei Darussalam': ['brunei', 'bandar seri begawan'],
                // ‚îÄ‚îÄ Oceania ‚îÄ‚îÄ
                'Australia': ['australia', 'sydney', 'melbourne', 'brisbane', 'perth', 'adelaide', 'canberra', 'gold coast', 'hobart'],
                'New Zealand': ['new zealand', 'auckland', 'wellington', 'christchurch', 'queenstown'],
                'Republic of Fiji': ['fiji', 'suva'],
                'Independent State of Papua New Guinea': ['papua new guinea', 'port moresby'],
                // ‚îÄ‚îÄ Latin America & Caribbean ‚îÄ‚îÄ
                'United Mexican States': ['mexico', 'm√©xico', 'mexico city', 'ciudad de m√©xico', 'guadalajara', 'monterrey', 'canc√∫n', 'puebla', 'tijuana'],
                'Federative Republic of Brazil': ['brazil', 'brasil', 's√£o paulo', 'sao paulo', 'rio de janeiro', 'bras√≠lia', 'brasilia', 'belo horizonte', 'curitiba', 'salvador', 'fortaleza'],
                'Argentine Republic': ['argentina', 'buenos aires', 'c√≥rdoba', 'rosario', 'mendoza'],
                'Republic of Chile': ['chile', 'santiago', 'valpara√≠so', 'concepci√≥n'],
                'Republic of Colombia': ['colombia', 'bogot√°', 'bogota', 'medell√≠n', 'medellin', 'cali', 'barranquilla', 'cartagena'],
                'Republic of Peru': ['peru', 'per√∫', 'lima', 'arequipa', 'cusco'],
                'Bolivarian Republic of Venezuela': ['venezuela', 'caracas'],
                'Republic of Ecuador': ['ecuador', 'quito', 'guayaquil'],
                'Republic of Paraguay': ['paraguay', 'asunci√≥n', 'asuncion'],
                'Eastern Republic of Uruguay': ['uruguay', 'montevideo', 'punta del este'],
                'Plurinational State of Bolivia': ['bolivia', 'la paz', 'santa cruz'],
                'Republic of Panama': ['panama', 'panam√°', 'panama city'],
                'Republic of Costa Rica': ['costa rica', 'san jos√©, costa rica'],
                'Republic of Guatemala': ['guatemala'],
                'Republic of Honduras': ['honduras', 'tegucigalpa'],
                'Republic of El Salvador': ['el salvador', 'san salvador'],
                'Republic of Nicaragua': ['nicaragua', 'managua'],
                'Republic of Cuba': ['cuba', 'havana', 'la habana'],
                'Dominican Republic': ['dominican republic', 'santo domingo', 'punta cana'],
                'Republic of Haiti': ['haiti', 'port-au-prince'],
                'Jamaica': ['jamaica', 'kingston, jamaica'],
                'Republic of Trinidad and Tobago': ['trinidad', 'tobago', 'port of spain'],
                'Barbados': ['barbados', 'bridgetown'],
                'Commonwealth of The Bahamas': ['bahamas', 'nassau, bahamas'],
                'Belize': ['belize', 'belize city', 'belmopan'],
                'Republic of Suriname': ['suriname', 'paramaribo'],
                'Co-operative Republic of Guyana': ['guyana', 'georgetown, guyana'],
                // ‚îÄ‚îÄ Africa ‚îÄ‚îÄ
                'Republic of South Africa': ['south africa', 'johannesburg', 'cape town', 'durban', 'pretoria'],
                'Federal Republic of Nigeria': ['nigeria', 'lagos', 'abuja', 'port harcourt'],
                'Republic of Kenya': ['kenya', 'nairobi', 'mombasa'],
                'Republic of Ghana': ['ghana', 'accra', 'kumasi'],
                'Republic of Tanzania': ['tanzania', 'dar es salaam', 'dodoma'],
                'Republic of Uganda': ['uganda', 'kampala'],
                'Republic of Rwanda': ['rwanda', 'kigali'],
                'Federal Democratic Republic of Ethiopia': ['ethiopia', 'addis ababa'],
                'Arab Republic of Egypt': ['egypt', 'cairo', 'alexandria', 'giza'],
                'Kingdom of Morocco': ['morocco', 'maroc', 'casablanca', 'rabat', 'marrakech', 'tangier'],
                'Republic of Tunisia': ['tunisia', 'tunis'],
                "People's Democratic Republic of Algeria": ['algeria', 'algiers'],
                'State of Libya': ['libya', 'tripoli, libya'],
                'Republic of Senegal': ['senegal', 'dakar'],
                "Republic of C√¥te d'Ivoire": ['ivory coast', "c√¥te d'ivoire", 'abidjan'],
                'Republic of Cameroon': ['cameroon', 'douala', 'yaound√©'],
                'Democratic Republic of the Congo': ['congo', 'kinshasa'],
                'Republic of Angola': ['angola', 'luanda'],
                'Republic of Mozambique': ['mozambique', 'maputo'],
                'Republic of Zimbabwe': ['zimbabwe', 'harare'],
                'Republic of Zambia': ['zambia', 'lusaka'],
                'Republic of Botswana': ['botswana', 'gaborone'],
                'Republic of Namibia': ['namibia', 'windhoek'],
                'Republic of Madagascar': ['madagascar', 'antananarivo'],
                'Republic of Malawi': ['malawi', 'lilongwe'],
                'Republic of the Sudan': ['sudan', 'khartoum'],
                'Republic of South Sudan': ['south sudan', 'juba'],
                'Somali Republic': ['somalia', 'mogadishu'],
                'Republic of Djibouti': ['djibouti'],
                'State of Eritrea': ['eritrea', 'asmara'],
                'Republic of Niger': ['niger', 'niamey'],
                'Republic of Mali': ['mali', 'bamako'],
                'Burkina Faso': ['burkina faso', 'ouagadougou'],
                'Republic of Chad': ['chad', "n'djamena"],
                'Republic of Guinea': ['guinea', 'conakry'],
                'Republic of Sierra Leone': ['sierra leone', 'freetown'],
                'Republic of Liberia': ['liberia', 'monrovia'],
                'Togolese Republic': ['togo', 'lom√©'],
                'Republic of Benin': ['benin', 'cotonou', 'porto-novo'],
                'Gabonese Republic': ['gabon', 'libreville'],
                'Republic of Equatorial Guinea': ['equatorial guinea', 'malabo'],
                'Republic of the Congo': ['brazzaville', 'republic of the congo'],
                'Central African Republic': ['central african republic', 'bangui'],
                'Republic of Mauritius': ['mauritius', 'port louis'],
                'Republic of Seychelles': ['seychelles', 'mah√©', 'victoria, seychelles'],
                // ‚îÄ‚îÄ Offshore / Special Jurisdictions ‚îÄ‚îÄ
                'British Virgin Islands': ['british virgin islands', 'bvi', 'tortola', 'road town'],
                'Cayman Islands': ['cayman islands', 'george town, cayman', 'grand cayman'],
                'Bermuda': ['bermuda', 'hamilton, bermuda'],
                'Jersey': ['jersey', 'saint helier', 'st helier'],
                'Guernsey': ['guernsey', 'st peter port'],
                'Isle of Man': ['isle of man', 'douglas, isle of man'],
                'Gibraltar': ['gibraltar'],
                'Republic of the Marshall Islands': ['marshall islands', 'majuro'],
                'Republic of Vanuatu': ['vanuatu', 'port vila'],
                'Principality of Monaco': ['monaco', 'monte carlo'],
                'Republic of San Marino': ['san marino'],
                'Principality of Andorra': ['andorra', 'andorra la vella'],
                'Cura√ßao': ['cura√ßao', 'curacao', 'willemstad'],
                'Aruba': ['aruba', 'oranjestad'],
                'Saint Kitts and Nevis': ['saint kitts', 'st kitts', 'nevis', 'basseterre'],
                'Antigua and Barbuda': ['antigua', 'barbuda'],
                'Saint Lucia': ['saint lucia', 'st lucia', 'castries'],
                'Saint Vincent and the Grenadines': ['saint vincent', 'st vincent'],
                'Commonwealth of Dominica': ['dominica', 'roseau'],
                'Republic of Palau': ['palau'],
                'Samoa': ['samoa', 'apia'],
                'Kingdom of Tonga': ['tonga'],
            };
            for (const [law, keywords] of Object.entries(map)) {
                for (const kw of keywords) {
                    if (addr.includes(kw)) return law;
                }
            }
            return null;
        }

        function toggleCustomGoverningLaw() {
            const sel = document.getElementById('governingLaw');
            const customInput = document.getElementById('governingLawCustom');
            customInput.classList.toggle('hidden', sel.value !== 'custom');
        }

        function updateGoverningLawOptions() {
            const sel = document.getElementById('governingLaw');
            const current = sel.value;
            sel.innerHTML = '';

            // Detect jurisdictions from party addresses
            const addrA = document.getElementById('partyAAddress').value;
            const addrB = document.getElementById('partyBAddress').value;
            const jurA = detectJurisdictionFromAddress(addrA);
            const jurB = detectJurisdictionFromAddress(addrB);

            // Party A option (default)
            const optA = document.createElement('option');
            optA.value = 'partyA';
            optA.textContent = jurA ? `${jurA} (Party A)` : 'Party A jurisdiction (default)';
            sel.appendChild(optA);

            // Party B option (if different)
            if (jurB && jurB !== jurA) {
                const optB = document.createElement('option');
                optB.value = jurB;
                optB.textContent = `${jurB} (Party B)`;
                sel.appendChild(optB);
            }

            // Custom option
            const customOpt = document.createElement('option');
            customOpt.value = 'custom';
            customOpt.textContent = 'Custom (type your own)...';
            sel.appendChild(customOpt);

            // Restore previous selection if still valid
            if (current && current !== 'partyA') {
                const exists = Array.from(sel.options).some(o => o.value === current);
                if (exists) sel.value = current;
                else sel.value = 'partyA';
            } else {
                sel.value = 'partyA';
            }
            toggleCustomGoverningLaw();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Step Navigation ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function goToStep2() { navigateStep(2); }
        function goToStep3() { navigateStep(3); }
        function backToStep1() { navigateStep(1); }

        function showTestimonials(show) {
            const el = document.querySelector('.testimonials-section');
            if (el) el.style.display = show ? '' : 'none';
        }

        function buildEmailTemplate() {
            const sendTo = document.getElementById('emailRecipient').value;

            // Determine sender/recipient based on dropdown
            let recipientName, recipientEmail, senderName, senderTitle, senderCompany, recipientCompany;
            if (sendTo === 'B') {
                recipientName = document.getElementById('partyBSignatory').value || '[Name]';
                recipientEmail = document.getElementById('partyBEmail').value || '';
                recipientCompany = document.getElementById('partyBName').value || '[Their Company]';
                senderName = document.getElementById('partyASignatory').value || '[Your Name]';
                senderTitle = document.getElementById('partyATitle').value;
                senderCompany = document.getElementById('partyAName').value || '[Your Company]';
            } else {
                recipientName = document.getElementById('partyASignatory').value || '[Name]';
                recipientEmail = document.getElementById('partyAEmail').value || '';
                recipientCompany = document.getElementById('partyAName').value || '[Their Company]';
                senderName = document.getElementById('partyBSignatory').value || '[Your Name]';
                senderTitle = document.getElementById('partyBTitle').value;
                senderCompany = document.getElementById('partyBName').value || '[Your Company]';
            }

            document.getElementById('emailTo').value = recipientEmail;

            const purpose = getPurpose();
            const confPeriod = document.getElementById('confPeriod').value;

            const purposeShort = document.getElementById('purposeSelect').value === 'custom'
                ? 'Our Discussion'
                : document.getElementById('purposeSelect').options[document.getElementById('purposeSelect').selectedIndex].text;

            const subject = `NDA for ${purposeShort} ‚Äî ${senderCompany} / ${recipientCompany}`;

            const body = `Dear ${recipientName},

Looking forward to our conversation regarding ${purpose.charAt(0).toLowerCase() + purpose.slice(1).replace(/\.$/, '')}. 

Before we proceed with sharing any confidential information, I have attached a Non-Disclosure Agreement for your review. The agreement is straightforward ‚Äî it provides standard ${confPeriod}-year confidentiality protections on what we share, with standard exclusions for publicly available information and materials already in your possession.

${generatedSummaryText ? 'I have also attached a plain-English summary so you can see exactly what the agreement covers without having to parse legal language.\n\n' : ''}Please review the attached at your convenience. If you have any questions or would like to suggest any amendments, I am happy to discuss.

Once you are comfortable with the terms, please countersign and return a copy at your earliest convenience so we can move forward.

Best regards,
${senderName}${senderTitle ? '\n' + senderTitle : ''}
${senderCompany}`;

            document.getElementById('emailSubject').value = subject;
            document.getElementById('emailBody').value = body;
        }

        function calculateNDAStrength(enhanced) {
            let score = 0;
            const tags = [];

            // ‚îÄ‚îÄ Base NDA scoring ‚îÄ‚îÄ
            // NDA Type
            const ndaType = document.getElementById('ndaType').value;
            if (ndaType === 'Mutual') { score += 8; tags.push({name:'Mutual NDA', on:true}); }
            else { score += 4; tags.push({name:'Unilateral', on:true}); }

            // Confidentiality Period
            const period = parseInt(document.getElementById('confPeriod').value);
            if (period >= 5) { score += 15; }
            else if (period >= 3) { score += 12; }
            else if (period >= 2) { score += 8; }
            else { score += 4; }
            tags.push({name: period + 'yr term', on: true});

            // Confidential Info categories
            const confChecked = document.querySelectorAll('.confInfo:checked').length;
            score += Math.min(confChecked * 2, 12);
            if (confChecked >= 5) tags.push({name: confChecked + ' info categories', on: true});

            // Custom confidential info
            if (document.getElementById('confInfoCustom').value.trim()) {
                score += 3;
                tags.push({name:'Custom categories', on:true});
            }

            // Base always includes: standard exclusions, authorised recipients, governing law, return of materials, notice obligations
            score += 28;
            tags.push({name:'Standard protections', on:true});

            // ‚îÄ‚îÄ Enhanced NDA scoring ‚îÄ‚îÄ
            if (enhanced) {
                // Residual Knowledge
                const residual = document.getElementById('residualKnowledge').value;
                if (residual === 'Restricted') { score += 8; tags.push({name:'Residual restricted', on:true}); }
                else { tags.push({name:'Residual permitted', on:false}); }

                // Return period
                const returnD = parseInt(document.getElementById('returnDays').value);
                if (returnD <= 10) { score += 5; } else if (returnD <= 14) { score += 3; } else { score += 1; }

                // Written certification
                if (document.getElementById('writtenCert').value === 'Yes') { score += 6; tags.push({name:'Destruction cert', on:true}); }
                else { tags.push({name:'No destruction cert', on:false}); }

                // Restrict advisors
                if (document.getElementById('restrictAdvisors').value === 'Yes') { score += 6; tags.push({name:'Advisors restricted', on:true}); }
                else { tags.push({name:'Advisors permitted', on:false}); }

                // LLM prohibition
                if (document.getElementById('prohibitLLM').value === 'Yes') { score += 5; tags.push({name:'AI/LLM prohibition', on:true}); }
                else { tags.push({name:'No AI clause', on:false}); }

                // Compelled disclosure notice
                if (document.getElementById('notifyCompelled').value === 'Yes') { score += 4; tags.push({name:'Disclosure notice', on:true}); }

                // Non-solicitation
                if (document.getElementById('prohibitSoliciting').value === 'Yes') { score += 8; tags.push({name:'Non-solicitation', on:true}); }
                else { tags.push({name:'No non-solicit', on:false}); }

                // Non-compete
                if (document.getElementById('nonCompete').value === 'Yes') { score += 8; tags.push({name:'Non-compete', on:true}); }
                else { tags.push({name:'No non-compete', on:false}); }

                // Breach remedy
                const remedy = document.getElementById('breachRemedy').value;
                if (remedy === 'Liquidated' || remedy === 'Penalty') { score += 10; tags.push({name: remedy === 'Liquidated' ? 'Liquidated damages' : 'Contractual penalty', on:true}); }
                else { tags.push({name:'Actual damages only', on:false}); }

                // Dispute resolution
                const dispute = document.getElementById('disputeMethod').value;
                if (dispute.includes('Arbitration')) { score += 6; tags.push({name:'Arbitration', on:true}); }
                if (dispute.includes('Mediation')) { score += 2; tags.push({name:'Mediation step', on:true}); }
            }

            // Clamp to 100
            score = Math.min(score, 100);

            // Determine level ‚Äî 5-tier scale
            let level, color;
            if (score >= 80) { level = 'Aggressive'; color = '#C0392B'; }
            else if (score >= 60) { level = 'Restrictive'; color = '#D4670A'; }
            else if (score >= 40) { level = 'Balanced'; color = '#27AE60'; }
            else if (score >= 20) { level = 'Moderate'; color = '#D4970A'; }
            else { level = 'Weak'; color = '#9A9490'; }

            return { score, level, color, tags };
        }

        function renderStrengthMeter(num, enhanced) {
            const { score, level, color, tags } = calculateNDAStrength(enhanced);
            const bar = document.getElementById('strengthBar' + num);
            const label = document.getElementById('strengthLabel' + num);
            const breakdown = document.getElementById('strengthBreakdown' + num);

            bar.style.width = score + '%';
            bar.style.background = color;

            label.textContent = level + ' ¬∑ ' + score + '/100';
            label.style.background = color + '18';
            label.style.color = color;

            breakdown.innerHTML = tags.map(t =>
                `<span class="strength-tag ${t.on ? 'active' : 'inactive'}">${t.on ? '‚úì' : '‚Äî'} ${t.name}</span>`
            ).join('');

            // ‚îÄ‚îÄ NDA Enforceability Score ‚îÄ‚îÄ
            let conf = 50; // AI-generated baseline
            conf = Math.min(conf, 50); // hard cap without playbook or lawyer

            const confBar = document.getElementById('confBar' + num);
            const confLabel = document.getElementById('confLabel' + num);
            const confNote = document.getElementById('confNote' + num);

            const confColor = '#D4970A';
            confBar.style.width = conf + '%';
            confBar.style.background = confColor;
            confLabel.textContent = conf + '%';
            confLabel.style.background = confColor + '18';
            confLabel.style.color = confColor;

            confNote.innerHTML = `Legal enforceability of AI-generated NDAs remains at <strong>50%</strong>. While we apply best practices in our generative prompts, AI models have inherent limitations and may produce inaccuracies. Applying the guidance from our <strong>"NDA Playbook in the AI Era"</strong> can increase the scale by up to <strong style="color:#D4670A;">70%</strong>, providing a general understanding of the enforceability gaps. Achieving <strong style="color:var(--green);">100%</strong> confidence and enforceability requires human legal expertise.`;
        }

        function updateDocsPanel() {
            const list = document.getElementById('docsList');
            let html = '';
            if (generatedNDAText) {
                html += `<div class="doc-item"><span class="doc-item-name"><span class="doc-icon" style="background:#EDE9FE;color:#7C3AED;">‚ö°</span> NDA Draft</span><div class="doc-item-actions"><button onclick="copyText(generatedNDAText)">Copy</button><button onclick="downloadPDF('ndaContent1','NDA.pdf')">PDF</button></div></div>`;
            }
            if (generatedNDAText2) {
                html += `<div class="doc-item"><span class="doc-item-name"><span class="doc-icon" style="background:#FEF3C7;color:#D97706;">üîí</span> Advanced NDA</span><div class="doc-item-actions"><button onclick="copyText(generatedNDAText2)">Copy</button><button onclick="downloadPDF('ndaContent2','NDA_Customized.pdf')">PDF</button></div></div>`;
            }
            if (generatedSummaryText) {
                html += `<div class="doc-item"><span class="doc-item-name"><span class="doc-icon" style="background:#DBEAFE;color:#2563EB;">üìÑ</span> Plain-English Summary</span><div class="doc-item-actions"><button onclick="copyText(generatedSummaryText)">Copy</button><button onclick="downloadPDF('summaryContent','NDA_Summary.pdf')">PDF</button></div></div>`;
            }
            const subj = document.getElementById('emailSubject');
            const body = document.getElementById('emailBody');
            if (subj && subj.value) {
                html += `<div class="doc-item"><span class="doc-item-name"><span class="doc-icon" style="background:#D1FAE5;color:#059669;">‚úâÔ∏è</span> Cover Email</span><div class="doc-item-actions"><button onclick="copyEmailText()">Copy</button></div></div>`;
            }
            list.innerHTML = html || '<div style="font-size:0.82rem;color:var(--text-muted);padding:4px 0;">No documents generated yet.</div>';
        }

        function updateChecklistProgress() {
            const checks = document.querySelectorAll('#preSendChecklist input[type="checkbox"]');
            const checked = document.querySelectorAll('#preSendChecklist input[type="checkbox"]:checked');
            const total = checks.length;
            const done = checked.length;
            document.getElementById('checklistBar').style.width = (done / total * 100) + '%';
            document.getElementById('checklistCount').textContent = done + ' / ' + total;
            if (done === total) {
                document.getElementById('checklistBar').style.background = 'var(--green)';
                document.getElementById('checklistCount').style.color = 'var(--green)';
            } else {
                document.getElementById('checklistBar').style.background = 'var(--accent)';
                document.getElementById('checklistCount').style.color = 'var(--text-muted)';
            }
        }

        function copyEmailText() {
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            const full = `Subject: ${subject}\n\n${body}`;
            navigator.clipboard.writeText(full).then(() => {
                const msg = document.getElementById('emailCopied');
                msg.classList.remove('hidden');
                setTimeout(() => msg.classList.add('hidden'), 2000);
            });
        }

        function openInMailClient() {
            const to = document.getElementById('emailTo').value || '';
            const subject = encodeURIComponent(document.getElementById('emailSubject').value);
            const body = encodeURIComponent(document.getElementById('emailBody').value);
            window.open(`mailto:${to}?subject=${subject}&body=${body}`, '_blank');
        }

        function updateBadge(step) {
            for (let i = 1; i <= 6; i++) {
                const badge = document.getElementById(`step${i}-badge`);
                if (!badge) continue;
                if (i < step) {
                    badge.className = 'step-badge done';
                    badge.querySelector('.step-num').textContent = '‚úì';
                } else if (i === step) {
                    badge.className = 'step-badge active';
                    badge.querySelector('.step-num').textContent = i;
                } else {
                    badge.className = 'step-badge inactive';
                    badge.querySelector('.step-num').textContent = i;
                }
            }
        }

        function navigateStep(step) {
            // Only allow navigation if first NDA has been generated (except step 1)
            if (!generatedNDAText && step !== 1) return;
            // Hide all steps
            for (let i = 1; i <= 6; i++) {
                const el = document.getElementById('step' + i);
                if (el) el.classList.add('hidden');
            }
            document.getElementById('step' + step).classList.remove('hidden');
            // Step-specific actions
            if (step === 1) {
                document.getElementById('persistentBlocks').classList.remove('hidden');
                showTestimonials(true);
            } else {
                showTestimonials(false);
            }
            if (step === 5) document.getElementById('summarySource').textContent = generatedNDAText2 ? 'Enhanced NDA' : 'Flash NDA';
            if (step === 6) { buildEmailTemplate(); updateDocsPanel(); }
            updateBadge(step);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function togglePartyKind(party) {
            const isIndividual = document.getElementById(`party${party}Kind`).checked;
            // Update hidden type field
            document.getElementById(`party${party}Type`).value = isIndividual ? 'Individual' : 'Company';
            // Update labels
            document.getElementById(`party${party}NameLabel`).textContent = isIndividual ? 'Full Name *' : 'Company Name *';
            document.getElementById(`party${party}AddressLabel`).textContent = isIndividual ? 'Address *' : 'Registered Address *';
            // Update placeholders
            document.getElementById(`party${party}Name`).placeholder = isIndividual ? 'Full legal name of the individual' : 'Full legal name';
            document.getElementById(`party${party}Address`).placeholder = isIndividual ? 'Residential or correspondence address' : 'Full registered address';
            document.getElementById(`party${party}Email`).placeholder = isIndividual ? 'personal@email.com' : 'contact@company.com';
            // Hide/show company-specific fields
            document.getElementById(`party${party}CompanyNumberGroup`).style.display = isIndividual ? 'none' : '';
            // Hide/show signatory row (individuals sign for themselves)
            document.getElementById(`party${party}SignatoryDivider`).style.display = isIndividual ? 'none' : '';
            document.getElementById(`party${party}SignatoryRow`).style.display = isIndividual ? 'none' : '';
        }

        function toggleSolicitFields() {
            const on = document.getElementById('prohibitSoliciting').value === 'Yes';
            document.getElementById('solicitScopeGroup').style.display = on ? '' : 'none';
            document.getElementById('solicitRow2').style.display = on ? '' : 'none';
        }
        function toggleCompeteFields() {
            const on = document.getElementById('nonCompete').value === 'Yes';
            document.getElementById('competeDurationGroup').style.display = on ? '' : 'none';
            document.getElementById('competeRow2').style.display = on ? '' : 'none';
        }
        function toggleBreachFields() {
            const val = document.getElementById('breachRemedy').value;
            const show = val !== 'Damages';
            document.getElementById('breachAmountGroup').style.display = show ? '' : 'none';
            document.getElementById('breachAmountLabel').textContent = val === 'Penalty' ? 'Penalty Amount' : 'Liquidated Damages Amount';
            document.getElementById('breachWarning').classList.toggle('hidden', val !== 'Penalty');
        }
        function toggleBreachCurrency() {
            const sel = document.getElementById('breachCurrency');
            document.getElementById('breachCurrencyCustom').classList.toggle('hidden', sel.value !== 'custom');
        }
        function getBreachCurrency() {
            const sel = document.getElementById('breachCurrency').value;
            return sel === 'custom' ? (document.getElementById('breachCurrencyCustom').value || 'USD') : sel;
        }

        function toggleArbFields() {
            const val = document.getElementById('disputeMethod').value;
            const arbFields = document.getElementById('arbFields');
            arbFields.classList.toggle('hidden', val === 'Courts');
            if (val !== 'Courts') {
                onArbInstitutionChange();
            }
        }

        const ARB_INSTITUTIONS = {
            ICC: {
                name: 'International Chamber of Commerce (ICC)',
                defaultSeat: 'Paris, France',
                modelClause: (seat, lang, govLaw, numArb) =>
                    `All disputes arising out of or in connection with this Agreement shall be finally settled under the Rules of Arbitration of the International Chamber of Commerce by ${numArb === '3' ? 'three arbitrators' : 'a sole arbitrator'} appointed in accordance with the said Rules. The seat of arbitration shall be ${seat}. The language of the arbitration shall be ${lang}. The arbitral proceedings and the award shall be kept confidential. The award shall be final and binding upon the Parties, who hereby waive any right to any form of recourse insofar as such waiver can validly be made. The prevailing Party shall be entitled to recover its reasonable legal fees and costs from the other Party.`
            },
            LCIA: {
                name: 'London Court of International Arbitration (LCIA)',
                defaultSeat: 'London, England',
                modelClause: (seat, lang, govLaw, numArb) =>
                    `Any dispute arising out of or in connection with this Agreement, including any question regarding its existence, validity or termination, shall be referred to and finally resolved by arbitration under the LCIA Rules, which Rules are deemed to be incorporated by reference into this clause. The number of arbitrators shall be ${numArb === '3' ? 'three' : 'one'}. The seat, or legal place, of arbitration shall be ${seat}. The language to be used in the arbitral proceedings shall be ${lang}. The governing law of this Agreement shall be the substantive law of ${govLaw || '[governing law jurisdiction]'}. The arbitral proceedings and the award shall be kept confidential. The prevailing Party shall be entitled to recover its reasonable legal fees and costs.`
            },
            AAA_ICDR: {
                name: 'International Centre for Dispute Resolution (ICDR)',
                defaultSeat: 'New York, USA',
                modelClause: (seat, lang, govLaw, numArb) =>
                    `Any controversy or claim arising out of or relating to this Agreement, or the breach thereof, shall be determined by arbitration administered by the International Centre for Dispute Resolution in accordance with its International Arbitration Rules. The number of arbitrators shall be ${numArb === '3' ? 'three' : 'one'}. The place of arbitration shall be ${seat}. The arbitration shall be held, and the award shall be rendered, in ${lang}. The award rendered by the arbitrator${numArb === '3' ? 's' : ''} shall be final and binding upon the Parties, and judgment on the award may be entered in any court having jurisdiction thereof. The arbitral proceedings and the award shall be kept confidential. The prevailing Party shall be entitled to recover its reasonable attorneys' fees and costs.`
            },
            SIAC: {
                name: 'Singapore International Arbitration Centre (SIAC)',
                defaultSeat: 'Singapore',
                modelClause: (seat, lang, govLaw, numArb) =>
                    `Any dispute arising out of or in connection with this Agreement, including any question regarding its existence, validity or termination, shall be referred to and finally resolved by arbitration administered by the Singapore International Arbitration Centre ("SIAC") in accordance with the Arbitration Rules of the Singapore International Arbitration Centre ("SIAC Rules") for the time being in force, which rules are deemed to be incorporated by reference in this clause. The seat of the arbitration shall be ${seat}. The Tribunal shall consist of ${numArb === '3' ? 'three arbitrators' : 'one arbitrator'}. The language of the arbitration shall be ${lang}. The award shall be final and binding upon the Parties. The arbitral proceedings and the award shall be kept confidential. The prevailing Party shall be entitled to recover its reasonable legal fees and costs.`
            },
            SCC: {
                name: 'Arbitration Institute of the Stockholm Chamber of Commerce (SCC)',
                defaultSeat: 'Stockholm, Sweden',
                modelClause: (seat, lang, govLaw, numArb) =>
                    `Any dispute, controversy or claim arising out of or in connection with this Agreement, or the breach, termination or invalidity thereof, shall be finally settled by arbitration in accordance with the Arbitration Rules of the Arbitration Institute of the Stockholm Chamber of Commerce. The arbitral tribunal shall be composed of ${numArb === '3' ? 'three arbitrators' : 'a sole arbitrator'}. The seat of arbitration shall be ${seat}. The language to be used in the arbitral proceedings shall be ${lang}. This Agreement shall be governed by the substantive law of ${govLaw || '[governing law jurisdiction]'}. The arbitral proceedings and the award shall be kept confidential. The prevailing Party shall be entitled to recover its reasonable legal fees and costs.`
            },
            DIAC: {
                name: 'Dubai International Arbitration Centre (DIAC)',
                defaultSeat: 'Dubai, UAE',
                modelClause: (seat, lang, govLaw, numArb) =>
                    `Any dispute arising out of the formation, performance, interpretation, nullification, termination or invalidation of this Agreement or arising therefrom or related thereto in any manner whatsoever, shall be settled by arbitration in accordance with the Arbitration Rules of the Dubai International Arbitration Centre ("DIAC Rules"), by ${numArb === '3' ? 'three arbitrators' : 'a sole arbitrator'} appointed in compliance with the DIAC Rules. The seat of arbitration shall be ${seat}. The language of arbitration shall be ${lang}. The award shall be final and binding upon the Parties. The arbitral proceedings and the award shall be kept confidential. The prevailing Party shall be entitled to recover its reasonable legal fees and costs.`
            }
        };

        function onArbInstitutionChange() {
            const key = document.getElementById('arbRules').value;
            const inst = ARB_INSTITUTIONS[key];
            if (!inst) return;

            // Auto-fill seat if empty or still a default
            const seatInput = document.getElementById('arbLocation');
            const allDefaults = Object.values(ARB_INSTITUTIONS).map(i => i.defaultSeat);
            if (!seatInput.value || allDefaults.includes(seatInput.value)) {
                seatInput.value = inst.defaultSeat;
            }

            // Update clause preview
            updateArbClausePreview();
        }

        function updateArbClausePreview() {
            const key = document.getElementById('arbRules').value;
            const inst = ARB_INSTITUTIONS[key];
            if (!inst) return;

            const seat = document.getElementById('arbLocation').value || inst.defaultSeat;
            const lang = document.getElementById('arbLanguage').value || 'English';
            const govLaw = getGoverningLaw() || '[governing law jurisdiction]';
            const numArb = document.getElementById('arbCount').value || '1';
            const clause = inst.modelClause(seat, lang, govLaw, numArb);

            document.getElementById('arbClauseText').textContent = clause;
            document.getElementById('arbClausePreview').style.display = 'block';
        }

        // Update preview when seat or language changes
        document.addEventListener('DOMContentLoaded', () => {
            const arbLoc = document.getElementById('arbLocation');
            const arbLang = document.getElementById('arbLanguage');
            if (arbLoc) arbLoc.addEventListener('input', updateArbClausePreview);
            if (arbLang) arbLang.addEventListener('change', updateArbClausePreview);
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Entity Type Auto-Detection ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function detectEntityType(name, fallback) {
            if (!name) return fallback || '';
            const n = name.toLowerCase().trim();
            const patterns = [
                [/\bpte\.?\s*ltd\.?$/,  'private limited company (Pte. Ltd.)'],
                [/\bltd\.?$/,          'private limited company (Ltd)'],
                [/\blimited$/,         'private limited company (Limited)'],
                [/\bplc\.?$/,          'public limited company (PLC)'],
                [/\bllp$/,             'limited liability partnership (LLP)'],
                [/\blp$/,              'limited partnership (LP)'],
                [/\bllc\.?$/,          'limited liability company (LLC)'],
                [/\binc\.?$/,          'corporation (Inc.)'],
                [/\bcorp\.?$/,         'corporation (Corp.)'],
                [/\bcorporation$/,     'corporation'],
                [/\bo√º$/,              'private limited company (O√ú)'],
                [/\bas$/,              'public limited company (AS)'],
                [/\bmt√º$/,            'non-profit association (MT√ú)'],
                [/\bfie$/,             'sole proprietor (FIE)'],
                [/\bgmbh\s*&?\s*co\.?\s*kg$/,  'limited partnership (GmbH & Co. KG)'],
                [/\bgmbh$/,            'limited liability company (GmbH)'],
                [/\bag$/,              'stock corporation (AG)'],
                [/\bug\b.*haftungsbeschr√§nkt/, 'entrepreneurial company (UG)'],
                [/\bb\.?\s*v\.?$/,     'private limited company (B.V.)'],
                [/\bn\.?\s*v\.?$/,     'public limited company (N.V.)'],
                [/\bsarl$/,            'limited liability company (SARL)'],
                [/\bsas$/,             'simplified joint-stock company (SAS)'],
                [/\bs\.?\s*l\.?$/,     'limited liability company (S.L.)'],
                [/\bs\.?\s*r\.?\s*o\.?$/, 'limited liability company (s.r.o.)'],
                [/\ba\.?\s*s\.?$/,     'joint-stock company (a.s.)'],
                [/\bv\.?\s*o\.?\s*s\.?$/, 'general partnership (v.o.s.)'],
                [/\bk\.?\s*s\.?$/,     'limited partnership (k.s.)'],
                [/\bsp\.?\s*z\.?\s*o\.?\s*o\.?$/, 'limited liability company (sp. z o.o.)'],
                [/\buab$/,             'private limited company (UAB)'],
                [/\bab$/,              'public limited company (AB)'],
                [/\bfz-?llc$/,         'free zone LLC (FZ-LLC)'],
                [/\bfze$/,             'free zone establishment (FZE)'],
                [/\bs\.?\s*r\.?\s*l\.?$/, 'limited liability company (S.r.l.)'],
                [/\bs\.?\s*p\.?\s*a\.?$/, 'joint-stock company (S.p.A.)'],
                [/\bs\.?\s*a\.?$/,     'public limited company (S.A.)'],
                [/\bpartnership$/,     'partnership'],
                [/\btrust$/,           'trust'],
                [/\bfoundation$/,      'foundation'],
            ];
            for (const [regex, type] of patterns) {
                if (regex.test(n)) return type;
            }
            if (fallback && fallback !== 'Company') {
                const map = { 'LTD': 'private limited company', 'LLC': 'limited liability company',
                    'Corporation': 'corporation', 'Partnership': 'partnership', 'Individual': 'individual' };
                return map[fallback] || fallback;
            }
            return '';
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NDA Generation ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function buildPrompt1() {
            const partyAIsIndividual = document.getElementById('partyAKind').checked;
            const partyBIsIndividual = document.getElementById('partyBKind').checked;
            const pA = {
                name: document.getElementById('partyAName').value || '[Party A Name]',
                companyNumber: partyAIsIndividual ? '' : document.getElementById('partyACompanyNumber').value,
                address: document.getElementById('partyAAddress').value || '[Party A Address]',
                email: document.getElementById('partyAEmail').value,
                signatory: partyAIsIndividual ? '' : document.getElementById('partyASignatory').value,
                title: partyAIsIndividual ? '' : document.getElementById('partyATitle').value,
                isIndividual: partyAIsIndividual
            };
            const pB = {
                name: document.getElementById('partyBName').value || '[Party B Name]',
                companyNumber: partyBIsIndividual ? '' : document.getElementById('partyBCompanyNumber').value,
                address: document.getElementById('partyBAddress').value || '[Party B Address]',
                email: document.getElementById('partyBEmail').value,
                role: getPartyBRole(),
                signatory: partyBIsIndividual ? '' : document.getElementById('partyBSignatory').value,
                title: partyBIsIndividual ? '' : document.getElementById('partyBTitle').value,
                isIndividual: partyBIsIndividual
            };
            pA.type = partyAIsIndividual ? 'individual (natural person)' : detectEntityType(pA.name, document.getElementById('partyAType').value);
            pB.type = partyBIsIndividual ? 'individual (natural person)' : detectEntityType(pB.name, document.getElementById('partyBType').value);

            const confInfoChecked = Array.from(document.querySelectorAll('.confInfo:checked')).map(cb => cb.value).join(', ');
            const confInfoCustom = document.getElementById('confInfoCustom').value.trim();
            const confInfo = [confInfoChecked, confInfoCustom].filter(Boolean).join(', ') || 'business information';
            let formattedDate = '[Date]';
            const dateVal = document.getElementById('agreementDate').value;
            if (dateVal) formattedDate = new Date(dateVal).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const isMutual = document.getElementById('ndaType').value === 'Mutual';
            const confPeriod = document.getElementById('confPeriod').value;
            const govLaw = getGoverningLaw() || '[Governing Law Jurisdiction]';
            const bindOthers = document.getElementById('bindOthers').value;

            return `You are a senior international corporate lawyer. Draft a comprehensive, enforceable Non-Disclosure Agreement. The agreement must be internally consistent: every defined term must be defined exactly once and used identically throughout, every section cross-reference must be numerically accurate, and no provision may contradict another.

‚ïê‚ïê‚ïê PARTY DETAILS ‚ïê‚ïê‚ïê

PARTY A:
- Full Legal Name: ${pA.name}
- Entity Type: ${pA.type || '(determine from company name and jurisdiction)'}${pA.companyNumber ? `\n- Registration/Company Number: ${pA.companyNumber}` : ''}
- ${pA.isIndividual ? 'Address' : 'Registered Address'}: ${pA.address}
- Email: ${pA.email || '[Email]'}${pA.signatory ? `\n- Authorised Signatory: ${pA.signatory}` : ''}${pA.title ? `\n- Title/Position: ${pA.title}` : ''}

PARTY B:
- Full Legal Name: ${pB.name}
- Entity Type: ${pB.type || '(determine from company name and jurisdiction)'}${pB.companyNumber ? `\n- Registration/Company Number: ${pB.companyNumber}` : ''}
- ${pB.isIndividual ? 'Address' : 'Registered Address'}: ${pB.address}
- Email: ${pB.email || '[Email]'}${pB.signatory ? `\n- Authorised Signatory: ${pB.signatory}` : ''}${pB.title ? `\n- Title/Position: ${pB.title}` : ''}

‚ïê‚ïê‚ïê KEY PARAMETERS ‚ïê‚ïê‚ïê

NDA TYPE: ${isMutual ? 'Mutual (both Parties may disclose and receive Confidential Information)' : 'Unilateral (Party A discloses, Party B receives)'}
PURPOSE: ${getPurpose()}
GOVERNING LAW: ${govLaw}
CONFIDENTIALITY SURVIVAL PERIOD: ${confPeriod} year(s) after termination or expiry
EFFECTIVE DATE: ${formattedDate}
BIND REPRESENTATIVES: ${bindOthers}
CONFIDENTIAL INFORMATION CATEGORIES: ${confInfo}

‚ïê‚ïê‚ïê DOCUMENT STRUCTURE ‚ïê‚ïê‚ïê

# ${isMutual ? 'MUTUAL ' : ''}NON-DISCLOSURE AGREEMENT

**Effective Date: ${formattedDate}**

Opening paragraph:
"This ${isMutual ? 'Mutual ' : ''}Non-Disclosure Agreement (hereinafter the **"Agreement"**) is entered into as of the Effective Date by and between:"

Identify each Party with: bold legal name, entity type (for a company: "a private limited company incorporated under the laws of [jurisdiction]", registration number if provided, registered address; for an individual: "an individual residing at [address]"), registered address or residential address. Then: "hereinafter referred to as **"Party A"**" / **"Party B"**, each individually a **"Party"** and collectively the **"Parties"**.

WHEREAS recitals:
1. ${isMutual ? 'WHEREAS, each Party possesses certain confidential and proprietary information, and the Parties wish to explore and evaluate a potential business relationship' : 'WHEREAS, Party A possesses certain confidential and proprietary information and wishes to disclose such information to Party B'} for the following purpose: ${getPurpose()} (hereinafter the **"Purpose"**).
2. WHEREAS, ${isMutual ? 'in the course of pursuing the Purpose, each Party (when disclosing Confidential Information, the **"Disclosing Party"**; when receiving Confidential Information, the **"Receiving Party"**) may disclose' : 'Party A (the **"Disclosing Party"**) wishes to disclose, and Party B (the **"Receiving Party"**) wishes to receive,'} Confidential Information solely in connection with the Purpose.
3. WHEREAS, the Parties wish to establish the terms and conditions governing the disclosure, receipt, and protection of such Confidential Information.

"NOW, THEREFORE, in consideration of the mutual covenants and agreements contained herein, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the Parties agree as follows:"

‚ïê‚ïê‚ïê SECTIONS ‚Äî follow this exact numbering ‚ïê‚ïê‚ïê

## 1. Definitions and Interpretation.
1.1. **"Confidential Information"** means all non-public information, whether in written, oral, electronic, visual, or any other form, disclosed by or on behalf of the Disclosing Party to the Receiving Party, directly or indirectly, that relates to the business, operations, finances, technology, products, services, or affairs of the Disclosing Party. Confidential Information includes information that is expressly marked or designated as confidential, as well as information that a reasonable person would understand to be confidential given the nature of the information and the circumstances of its disclosure.

1.2. Without limiting the generality of the foregoing, Confidential Information includes the following categories:
Provide a DETAILED enumerated list of at least 10 specific items based on: ${confInfo}. Cover at minimum: (a) corporate structure, ownership, and governance documents; (b) trade secrets, proprietary processes, and know-how; (c) business plans, strategies, and financial projections; (d) financial data, pricing models, and cost structures; (e) client lists, customer data, and supplier information; (f) investor information and fundraising activities; (g) employee and contractor information, compensation data; (h) intellectual property, patents, trademarks, copyrights, and licence agreements; (i) source code, algorithms, technical designs, and specifications; (j) security systems, access protocols, and cybersecurity measures; (k) marketing strategies and business development plans; (l) any information expressly marked or designated as "Confidential" or "Proprietary"; (m) any other information disclosed in connection with the Purpose.

1.3. **"Unlawful Disclosure"** means any unauthorised disclosure, use, copying, reproduction, or exploitation of Confidential Information in breach of this Agreement.

${bindOthers === 'Yes' ? '1.4. **"Authorised Recipients"** means the Receiving Party\'s directors, officers, employees, contractors, and professional advisors who have a legitimate need to access Confidential Information solely for the Purpose and who are bound by written confidentiality obligations no less restrictive than those contained in this Agreement.' : ''}

1.${bindOthers === 'Yes' ? '5' : '4'}. **Interpretation.** In this Agreement: (a) headings are for convenience only and shall not affect interpretation; (b) "including" and similar expressions mean "including but not limited to"; (c) references to any statute or regulation include any amendments, re-enactments, or successor legislation; (d) words in the singular include the plural and vice versa; (e) references to Sections are to sections of this Agreement.

## 2. Exclusions from Confidential Information.
2.1. Information shall not constitute Confidential Information if the Receiving Party can demonstrate by documentary evidence that such information:
(a) was in the public domain at the time of disclosure, or subsequently entered the public domain through no fault, act, or omission of the Receiving Party;
(b) was lawfully in the Receiving Party's possession prior to disclosure by the Disclosing Party, without any obligation of confidentiality;
(c) was independently developed by the Receiving Party without reference to or use of the Confidential Information; or
(d) was lawfully received from a third party who was not subject to any obligation of confidentiality with respect to such information.

2.2. The burden of proving any exclusion under this Section 2 rests solely with the Receiving Party. Any combination of information shall be treated as Confidential Information even if individual components are within the public domain, provided that the specific combination is not in the public domain.

## 3. Confidentiality Obligations.
3.1. The Receiving Party shall:
(a) hold all Confidential Information in strict confidence and not disclose it to any person except as expressly permitted under this Agreement;
(b) use the Confidential Information solely for the Purpose and for no other purpose whatsoever;
(c) not copy, reproduce, or reduce to writing any Confidential Information except as strictly necessary for the Purpose;
(d) apply no less a degree of care to protect the Confidential Information than it applies to protect its own confidential information of a similar nature, and in any event no less than reasonable care;
(e) restrict access to Confidential Information to ${bindOthers === 'Yes' ? 'its Authorised Recipients' : 'its directors and officers'} who have a genuine need to know for the Purpose; and
(f) promptly notify the Disclosing Party in writing upon becoming aware of any actual or suspected Unlawful Disclosure.

${bindOthers === 'Yes' ? '3.2. Prior to granting any Authorised Recipient access to Confidential Information, the Receiving Party shall ensure that such Authorised Recipient: (a) has been informed of the confidential nature of the information; and (b) is bound by written confidentiality obligations no less restrictive than this Agreement. The Receiving Party shall remain fully liable for any breach by its Authorised Recipients as if it were a direct breach by the Receiving Party.' : '3.2. The Receiving Party shall not disclose any Confidential Information to any employee, contractor, or agent without the prior written consent of the Disclosing Party.'}

## 4. Permitted Disclosure.
4.1. The Receiving Party may disclose Confidential Information to ${bindOthers === 'Yes' ? 'its Authorised Recipients' : 'its directors and officers'} solely to the extent necessary for the Purpose, subject to the obligations in Section 3.

4.2. If the Receiving Party or any ${bindOthers === 'Yes' ? 'Authorised Recipient' : 'person to whom disclosure is permitted'} becomes legally compelled by any applicable law, regulation, judicial or governmental order, or proceeding to disclose any Confidential Information, the Receiving Party shall, to the extent legally permitted:
(a) provide the Disclosing Party with prompt prior written notice of such requirement;
(b) cooperate with the Disclosing Party in seeking a protective order or other appropriate remedy;
(c) disclose only the minimum portion of Confidential Information that is legally required; and
(d) use commercially reasonable efforts to obtain confidential treatment for any information so disclosed.

4.3. Any disclosure made pursuant to Section 4.2 shall not relieve the Receiving Party of its obligations under this Agreement with respect to any Confidential Information not so disclosed.

## 5. Return or Destruction of Confidential Information.
5.1. Upon the earlier of: (a) written request by the Disclosing Party; or (b) termination or expiry of this Agreement, the Receiving Party shall promptly:
(i) return to the Disclosing Party all originals and copies of Confidential Information in any form;
(ii) permanently delete or destroy all Confidential Information stored in electronic systems, databases, or any other media under its control or the control of its ${bindOthers === 'Yes' ? 'Authorised Recipients' : 'representatives'}; and
(iii) provide the Disclosing Party with written certification of compliance, signed by an authorised officer, confirming that all Confidential Information has been returned or destroyed.

5.2. Notwithstanding Section 5.1, the Receiving Party may retain copies of Confidential Information to the extent required by applicable law or regulation, or contained in routine electronic backup systems, provided that all retained copies shall remain subject to the confidentiality obligations of this Agreement for the duration of their retention.

## 6. Intellectual Property and Reservation of Rights.
6.1. All Confidential Information shall remain the exclusive property of the Disclosing Party. Nothing in this Agreement shall be construed to grant the Receiving Party any licence, right, title, or interest in or to the Confidential Information or any intellectual property of the Disclosing Party.
6.2. Neither Party shall acquire any right or licence under any patent, copyright, trademark, trade secret, or other intellectual property right of the other Party by reason of this Agreement or any disclosure hereunder.
6.3. Nothing in this Agreement shall obligate either Party to enter into any further agreement, proceed with any transaction, or continue any business relationship.

## 7. Remedies.
7.1. The Parties acknowledge that the Confidential Information is of a special and unique character, and that any breach or threatened breach of this Agreement may cause irreparable harm to the Disclosing Party for which monetary damages alone would be an insufficient remedy.
7.2. In the event of any breach or threatened breach, the Disclosing Party shall be entitled to seek injunctive relief, specific performance, and any other equitable remedies available under applicable law, without the requirement to post a bond or other security and without the need to prove actual damages.
7.3. The rights and remedies provided in this Agreement are cumulative and in addition to, not in substitution for, any other rights and remedies available at law or in equity.

## 8. Term and Termination.
8.1. This Agreement shall commence on the Effective Date and remain in force until terminated in accordance with this Section 8.
8.2. Either Party may terminate this Agreement at any time by providing thirty (30) days' prior written notice to the other Party.
8.3. Either Party may terminate this Agreement immediately upon written notice if the other Party commits a material breach of any provision of this Agreement.
8.4. Upon termination or expiry of this Agreement, the provisions of Sections 1, 2, 3, 4.2, 5, 6, 7, and this Section 8.4 shall survive and continue in full force and effect for a period of ${confPeriod} year(s) from the date of termination or expiry.
8.5. Termination of this Agreement shall not release either Party from any liability arising from any breach occurring prior to or upon such termination.

## 9. Dispute Resolution.
9.1. The Parties shall first attempt to resolve any dispute arising out of or in connection with this Agreement through good-faith negotiations for a period of thirty (30) days commencing from the date on which one Party provides the other with written notice of such dispute.
9.2. If the dispute is not resolved within the period specified in Section 9.1, the courts of ${govLaw} shall have exclusive jurisdiction to hear and determine any such dispute. Each Party irrevocably submits to the exclusive jurisdiction of such courts and waives any objection to the laying of venue or any claim of inconvenient forum.

## 10. General Provisions.
10.1. **Assignment.** Neither Party may assign, transfer, or delegate any of its rights or obligations under this Agreement without the prior written consent of the other Party. Any purported assignment in violation of this Section shall be null and void.
10.2. **Entire Agreement.** This Agreement constitutes the entire agreement between the Parties with respect to the subject matter hereof and supersedes all prior and contemporaneous negotiations, representations, warranties, and agreements, whether written or oral.
10.3. **Amendments.** No amendment, modification, or supplement to this Agreement shall be valid or binding unless made in writing and signed by duly authorised representatives of both Parties.
10.4. **Waiver.** No failure or delay by either Party in exercising any right, power, or remedy under this Agreement shall operate as a waiver thereof, nor shall any single or partial exercise preclude any further exercise of such right, power, or remedy.
10.5. **Severability.** If any provision of this Agreement is held by a court of competent jurisdiction to be invalid, illegal, or unenforceable, such provision shall be modified to the minimum extent necessary to render it valid and enforceable, or if modification is not possible, shall be severed from this Agreement. The remaining provisions shall continue in full force and effect.
10.6. **Counterparts.** This Agreement may be executed in any number of counterparts, each of which shall constitute an original, and all of which together shall constitute one and the same agreement. Execution and delivery by electronic means, including PDF or qualified electronic signature, shall be as valid and effective as original ink signatures.
10.7. **Governing Law.** This Agreement shall be governed by and construed in accordance with the laws of ${govLaw}, without regard to its conflict of laws principles.
10.8. **Notices.** All notices, requests, and other communications under this Agreement shall be in writing and shall be deemed duly given: (a) upon delivery, if delivered by hand or internationally recognised courier service; or (b) upon transmission, if sent by email to the addresses specified in the preamble of this Agreement, provided that the sender does not receive an automated non-delivery notification.

**IN WITNESS WHEREOF**, the Parties have executed this Agreement as of the Effective Date.

| **${pA.name}** | **${pB.name}** |
|---|---|
| Signature: ______________________ | Signature: ______________________ |
| Name: ${pA.isIndividual ? pA.name : (pA.signatory || '_______________')} | Name: ${pB.isIndividual ? pB.name : (pB.signatory || '_______________')} |
${pA.isIndividual && pB.isIndividual ? '' : `| Title: ${pA.isIndividual ? 'N/A (individual)' : (pA.title || '_______________')} | Title: ${pB.isIndividual ? 'N/A (individual)' : (pB.title || '_______________')} |`}
| Email: ${pA.email || '_______________'} | Email: ${pB.email || '_______________'} |
| Date: ______________________ | Date: ______________________ |

‚ïê‚ïê‚ïê MANDATORY QUALITY RULES ‚ïê‚ïê‚ïê

INTERNAL CONSISTENCY:
- Every defined term (bold, in quotes) must be defined ONCE and used IDENTICALLY throughout. Do not introduce synonyms or variations.
- ${isMutual ? 'MUTUAL NDA: Every obligation MUST apply symmetrically to both Parties. Use "each Party", "the Disclosing Party / the Receiving Party" construction. Do NOT create any asymmetric obligation.' : 'UNILATERAL NDA: Party A is always the Disclosing Party; Party B is always the Receiving Party. Maintain this consistently ‚Äî never reverse the roles.'}
- All cross-references must be numerically correct (e.g., "pursuant to Section 4.2", "as defined in Section 1.1").
- The governing law in Section 10.7 MUST match the jurisdiction in Section 9.2.
- The survival period in Section 8.4 MUST be "${confPeriod} year(s)".
- Section 8.4 must list the exact section numbers that survive ‚Äî verify they exist and are correct.

ENFORCEABILITY:
- Use objective, measurable standards: "thirty (30) days", "written notice", "documentary evidence".
- Every obligation must identify: the obligated party, the required action, and the scope or limitation.
- The exclusions in Section 2 must use the "demonstrate by documentary evidence" standard consistently.
- Remedies must preserve both equitable (injunctive, specific performance) and legal (damages) relief.

FORMATTING:
- Professional legal English ‚Äî formal, precise, enforceable.
- "shall" for obligations, "may" for permissions.
- Bold defined terms at first introduction only.
- Every sentence ends with a period. Every sub-clause ends with a semicolon, comma, or period as grammatically appropriate.
- Sub-clause numbering: 1.1., 1.2.; within sub-clauses: (a), (b), (c).
- Length: 2500‚Äì3500 words.
- Output ONLY the agreement text. No commentary, no preamble, no notes.
- Start directly with the # title heading.`;
        }

        function buildPrompt2() {
            const v = id => document.getElementById(id).value;
            const confPeriod = v('confPeriod');
            const govLaw = getGoverningLaw() || '[governing law jurisdiction]';
            const isMutual = v('ndaType') === 'Mutual';

            // Build enhancement blocks conditionally
            let enhancements = [];
            let newSections = [];
            let n = 1;

            // ‚îÄ‚îÄ 1. Residual Knowledge (always included) ‚îÄ‚îÄ
            enhancements.push(`${n}. **Residual Knowledge** ‚Äî integrate into Section 3 (Confidentiality Obligations) as a new sub-clause:
   ${v('residualKnowledge') === 'Restricted' ? 'RESTRICTED: The Receiving Party shall not use any residual knowledge (information retained in unaided memory without intentional memorisation) for competitive purposes, to develop competing products or services, or to the detriment of the Disclosing Party. This restriction applies even after termination of this Agreement for the duration of the confidentiality survival period.' : 'PERMITTED: Nothing in this Agreement shall prevent the Receiving Party from using general knowledge, skills, and experience retained in the unaided memory of its personnel in the ordinary course of business, provided that the Receiving Party shall not intentionally memorise Confidential Information for the purpose of circumventing this Agreement.'}`);
            n++;

            // ‚îÄ‚îÄ 2. Return of Materials (always included) ‚îÄ‚îÄ
            enhancements.push(`${n}. **Return of Materials** ‚Äî strengthen Section 5:
   - Specify that all Confidential Information must be returned or destroyed within ${v('returnDays')} calendar days of the earlier of: (a) written request by the Disclosing Party; or (b) termination or expiry of this Agreement.
   - Written certification of destruction required: ${v('writtenCert')}.
   - Retain the exception for copies required by law or on routine backup systems (subject to ongoing confidentiality obligations).
   - Ensure the timeframe is consistent throughout (Section 5.1 must match this number exactly).`);
            n++;

            // ‚îÄ‚îÄ 3. Restrict Professional Advisors (only if restricting) ‚îÄ‚îÄ
            if (v('restrictAdvisors') === 'Yes') {
                enhancements.push(`${n}. **Professional Advisors ‚Äî Restriction** ‚Äî modify Section 4:
   The base NDA permits disclosure to professional advisors. REPLACE this with a restriction: disclosure of Confidential Information to the Receiving Party's external legal counsel, accountants, auditors, or financial advisors shall require the prior written consent of the Disclosing Party. Remove any existing sub-clause that permits disclosure to professional advisors without consent.`);
                n++;
            }

            // ‚îÄ‚îÄ 4. Compelled Disclosure ‚îÄ‚îÄ
            enhancements.push(`${n}. **Compelled Disclosure** ‚Äî verify and strengthen Section 4.2:
   ${v('notifyCompelled') === 'Yes' ? 'Ensure Section 4.2 includes ALL of the following: (a) the Receiving Party must provide the Disclosing Party with prompt prior written notice of any compelled disclosure, UNLESS such notice is expressly prohibited by the relevant court order, governmental directive, or applicable law; (b) cooperation with the Disclosing Party in seeking a protective order or limiting the scope of disclosure; (c) disclosure of only the minimum portion legally required; and (d) commercially reasonable efforts to obtain confidential treatment for the disclosed information. If any of these elements are missing from the base NDA, add them.' : 'Simplify Section 4.2: Confidential Information may be disclosed to the extent strictly required by applicable law, regulation, or binding order of a court or governmental authority, without any prior notice obligation.'}`);
            n++;

            // ‚îÄ‚îÄ 5. Prohibit Public LLM / AI Uploads ‚îÄ‚îÄ
            if (v('prohibitLLM') === 'Yes') {
                enhancements.push(`${n}. **Prohibition on AI / LLM Processing** ‚Äî add as a new sub-clause in Section 3 (Confidentiality Obligations):
   The Receiving Party shall not input, upload, submit, or otherwise process any Confidential Information through any publicly available artificial intelligence system, large language model, machine learning tool, or similar technology (including but not limited to ChatGPT, Claude, Gemini, Copilot, or any successor or equivalent service) where such input may be used for model training, stored beyond the session, or accessible to third parties. This prohibition extends to any AI-powered tool where the Receiving Party cannot guarantee that the Confidential Information will not be retained, processed, or exposed beyond the Receiving Party's direct control. Use of enterprise-deployed AI tools with contractual data protection guarantees equivalent to this Agreement may be permitted with the prior written consent of the Disclosing Party.`);
                n++;
            }

            // ‚îÄ‚îÄ 6. Non-Solicitation (conditional) ‚îÄ‚îÄ
            if (v('prohibitSoliciting') === 'Yes') {
                const scope = v('solicitScope');
                const duration = v('solicitDuration');
                const carveout = v('solicitCarveout');
                let scopeText = 'any employee or officer';
                if (scope === 'Employees+Contractors') scopeText = 'any employee, officer, contractor, or consultant';
                if (scope === 'All+Clients') scopeText = 'any employee, officer, contractor, consultant, client, or customer';

                enhancements.push(`${n}. **Non-Solicitation** ‚Äî ADD as a new section (insert after Remedies, before Term and Termination):
   - For a period of ${duration} months from the Effective Date, neither Party shall directly or indirectly solicit, recruit, hire, induce, or attempt to solicit ${scopeText} of the other Party who has had access to Confidential Information under this Agreement, without the prior written consent of that Party.
   ${carveout === 'Yes' ? '- Carve-out: This restriction shall not apply to general advertisements or public job postings not specifically targeted at the other Party\'s personnel, provided that the advertising Party did not directly or indirectly encourage such personnel to respond to such advertisement.' : '- No carve-out: All forms of solicitation are prohibited, including responses to general advertisements where the soliciting Party had prior knowledge of the individual\'s engagement with the other Party.'}
   - Update the survival clause to include this new section.`);
                newSections.push('Non-Solicitation');
                n++;
            }

            // ‚îÄ‚îÄ 7. Non-Compete (conditional) ‚îÄ‚îÄ
            if (v('nonCompete') === 'Yes') {
                const compDuration = v('competeDuration');
                const compGeo = document.getElementById('competeGeo').value || '[geographic scope to be specified]';
                const compScope = document.getElementById('competeScope').value || '[industry/activity scope to be specified]';

                enhancements.push(`${n}. **Non-Compete** ‚Äî ADD as a new section (insert after Non-Solicitation if present, otherwise after Remedies):
   - For a period of ${compDuration} months from the Effective Date, the Receiving Party shall not, directly or indirectly, engage in, own, manage, operate, control, be employed by, consult for, or otherwise participate in any business that competes with the Disclosing Party's business within the following scope:
   - Geographic scope: ${compGeo}.
   - Activity/industry scope: ${compScope}.
   - This restriction must be reasonable and proportionate. Include a severability sub-clause: if any court finds the scope, duration, or geographic restriction to be unreasonable, the court may modify (rather than void) the restriction to the minimum extent necessary to make it enforceable.
   ${isMutual ? '- In a mutual NDA, apply this restriction symmetrically to both Parties.' : '- This restriction applies to Party B (the Receiving Party) only.'}
   - IMPORTANT: Note in the clause that non-compete restrictions are unenforceable or severely limited in certain jurisdictions (e.g., California, Colorado, Minnesota in the USA; and may be limited in duration/scope under EU member state laws). The enforceability of this clause depends on the governing law of this Agreement.
   - Update the survival clause to include this new section.`);
                newSections.push('Non-Compete');
                n++;
            }

            // ‚îÄ‚îÄ 8. Compensation for Breach ‚îÄ‚îÄ
            const remedy = v('breachRemedy');
            const amount = document.getElementById('breachAmount').value;
            const currency = getBreachCurrency();
            if (remedy !== 'Damages') {
                enhancements.push(`${n}. **Compensation for Breach** ‚Äî strengthen the Remedies section:
   ${remedy === 'Liquidated' ? `Add a liquidated damages clause: In addition to any other remedies available under this Agreement or applicable law, the Parties agree that in the event of a breach of the confidentiality obligations, the breaching Party shall pay to the non-breaching Party liquidated damages in the amount of ${currency} ${amount || '[amount to be specified]'} per breach, which the Parties acknowledge and agree represents a genuine pre-estimate of the loss that would be suffered and is not intended as a penalty.
   - IMPORTANT: This must be framed as a "genuine pre-estimate of loss" (not a penalty) to be enforceable in common law jurisdictions (UK, USA, Singapore, Hong Kong, Australia).` : `Add a contractual penalty clause: In addition to any other remedies available under this Agreement or applicable law, the breaching Party shall pay to the non-breaching Party a contractual penalty in the amount of ${currency} ${amount || '[amount to be specified]'} per breach.
   - Include a note: "The Parties acknowledge that this contractual penalty is enforceable under the governing law of this Agreement."
   - IMPORTANT WARNING: Contractual penalties are enforceable in civil law jurisdictions (EU member states, Latin America, UAE, CIS countries) but are generally UNENFORCEABLE in common law jurisdictions (UK, USA, Singapore, Hong Kong, Australia). If the governing law is a common law jurisdiction, reframe this as liquidated damages instead.`}
   - The remedies clause must state that liquidated damages/penalties are IN ADDITION TO (not in substitution for) injunctive relief, specific performance, and actual damages.`);
                n++;
            }

            // ‚îÄ‚îÄ 9. Dispute Resolution (always included) ‚îÄ‚îÄ
            const disputeBlock = v('disputeMethod') !== 'Courts' ? (() => {
                const key = v('arbRules');
                const inst = ARB_INSTITUTIONS[key];
                const seat = v('arbLocation') || (inst ? inst.defaultSeat : '[To be specified]');
                const lang = document.getElementById('arbLanguage').value || 'English';
                const clauseText = inst ? inst.modelClause(seat, lang, govLaw, v('arbCount') || '1') : '';
                return `Replace with arbitration:
   Institution: ${inst ? inst.name : key}
   Seat/Place: ${seat}
   Language: ${lang}

   Structure:
   First sub-clause: Good-faith negotiations for thirty (30) days.
   ${v('disputeMethod') === 'Mediation then Arbitration' ? 'Second sub-clause: If negotiations fail, mediation for a further thirty (30) days.\n   Third sub-clause:' : 'Second sub-clause:'} Arbitration ‚Äî use this model clause (preserve ALL substantive terms verbatim, adapt only section numbering):
   "${clauseText}"
   Ensure the governing law reference within the arbitration clause matches the Governing Law section exactly.`;
            })() : `Keep courts-based resolution:
   First sub-clause: Good-faith negotiations for thirty (30) days from written notice of dispute.
   Second sub-clause: Courts of ${govLaw} shall have exclusive jurisdiction. Each Party irrevocably submits to such jurisdiction and waives any objection to venue.
   Ensure the jurisdiction matches the Governing Law section exactly.`;

            enhancements.push(`${n}. **Dispute Resolution** ‚Äî rewrite the Dispute Resolution section:
   Method: ${v('disputeMethod')}
   ${disputeBlock}`);

            return `You are a senior international corporate lawyer. You are given an existing NDA and a list of enhancements. Produce a COMPLETE, enhanced version of the NDA integrating all specified enhancements while maintaining perfect internal consistency.

EXISTING NDA:
${generatedNDAText}

‚ïê‚ïê‚ïê ENHANCEMENTS ‚ïê‚ïê‚ïê

${enhancements.join('\n\n')}

‚ïê‚ïê‚ïê MANDATORY RULES ‚ïê‚ïê‚ïê

OUTPUT: The COMPLETE enhanced NDA from title to signature block. Every section of the original must be present. Do not omit anything.

INTERNAL CONSISTENCY:
- All defined terms must remain exactly as defined in the original NDA. Only introduce new defined terms if explicitly required by the enhancements above.
- ALL section cross-references must be numerically accurate. After inserting ${newSections.length > 0 ? 'new sections (' + newSections.join(', ') + ')' : 'any modifications'}, renumber ALL subsequent sections and update EVERY cross-reference in the entire document.
- The survival clause must list ALL surviving sections by their CORRECT final number ‚Äî verify each one exists.
- Governing law must match between the Governing Law and Dispute Resolution sections.
- Confidentiality survival period must remain exactly ${confPeriod} year(s) everywhere it appears.
- ${isMutual ? 'MUTUAL NDA: Every obligation must apply symmetrically to both Parties.' : 'UNILATERAL NDA: Party A = Disclosing Party, Party B = Receiving Party throughout.'}

SECTION NUMBERING:
- Insert new sections in logical order: after current Remedies section, before Term and Termination.${newSections.length > 0 ? '\n- New sections to insert: ' + newSections.join(', ') + '.' : ''}
- Renumber ALL subsequent sections after any insertion.
- After renumbering, perform a FINAL PASS to verify every cross-reference points to the correct section number.

NO CONTRADICTIONS:
- The Remedies section must not limit remedies to ONLY damages if liquidated damages or penalties are added ‚Äî state they are "in addition to" all other remedies.
- If non-compete is added, it must not contradict any residual knowledge clause.
- If professional advisor restriction is added, ensure Section 4 (Permitted Disclosure) does not simultaneously permit and restrict advisor disclosure.
- Compelled disclosure provisions must be consistent with the notice obligation setting.

FORMATTING:
- Bold defined terms at first use only.
- Numbering: ## 1., sub-clauses 1.1., lists (a), (b), (c).
- Every sentence ends with a period.
- Preserve the signature block table with all fields.
- No commentary, notes, or text outside the agreement.
- Start directly with the # title heading.
- Length: 3000‚Äì5000 words.`;
        }
        async function safeJson(res) {
            const text = await res.text();
            try { return JSON.parse(text); }
            catch (e) {
                if (text.trim().startsWith('<')) throw new Error('Server returned an error page ‚Äî the function may have timed out. Please try again.');
                throw new Error('Invalid response from server');
            }
        }

        // Non-streaming fallback: calls the old generate-nda function
        async function fallbackGenerate(prompt, contentEl) {
            if (contentEl) contentEl.innerHTML = '<p style="color:var(--text-muted);font-style:italic;">Generating (non-streaming)...</p>';
            const res = await fetch('/.netlify/functions/generate-nda', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt })
            });
            const data = await safeJson(res);
            if (!res.ok) throw new Error(data.error || 'Generation failed');
            return data.result;
        }

        // Streaming: calls V2 function, renders text in real-time, returns full text
        async function streamGenerate(prompt, contentEl, resultEl, loadingEl) {
            if (resultEl) resultEl.classList.remove('hidden');
            if (contentEl) contentEl.innerHTML = '<p style="color:var(--text-muted);font-style:italic;">Generating...</p>';

            let res;
            try {
                res = await fetch('/api/generate-nda-stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });
            } catch (fetchErr) {
                // Network error ‚Äî fall back
                console.warn('Streaming fetch failed, falling back:', fetchErr);
                const result = await fallbackGenerate(prompt, contentEl);
                if (contentEl) contentEl.innerHTML = formatNDA(result);
                if (loadingEl) loadingEl.classList.add('hidden');
                return result;
            }

            // If response is JSON (error response) or HTML (Netlify error page)
            const ct = res.headers.get('content-type') || '';

            if (ct.includes('application/json')) {
                // JSON error from our function
                let data;
                try { data = await res.json(); } catch(e) { data = {}; }
                throw new Error(data.error || 'Generation failed');
            }

            if (!ct.includes('text/event-stream')) {
                // Not SSE ‚Äî probably HTML error page or 404. Fall back to regular function.
                console.warn('Streaming endpoint returned non-SSE (' + ct + '), status:', res.status, '‚Äî falling back');
                const result = await fallbackGenerate(prompt, contentEl);
                if (contentEl) contentEl.innerHTML = formatNDA(result);
                if (loadingEl) loadingEl.classList.add('hidden');
                return result;
            }

            if (!res.ok) {
                console.warn('Streaming endpoint failed with status', res.status, '‚Äî falling back');
                const result = await fallbackGenerate(prompt, contentEl);
                if (contentEl) contentEl.innerHTML = formatNDA(result);
                if (loadingEl) loadingEl.classList.add('hidden');
                return result;
            }

            // Read SSE stream
            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            let fullText = '';
            let buffer = '';
            let renderTimer = null;

            function scheduleRender() {
                if (renderTimer) return;
                renderTimer = setTimeout(() => {
                    renderTimer = null;
                    if (contentEl) contentEl.innerHTML = formatNDA(fullText + '‚ñä');
                }, 100);
            }

            try {
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';

                    for (const line of lines) {
                        if (!line.startsWith('data: ')) continue;
                        const data = line.slice(6).trim();
                        if (data === '[DONE]') continue;

                        try {
                            const parsed = JSON.parse(data);
                            if (parsed.error) throw new Error(parsed.error);
                            if (parsed.text) {
                                fullText += parsed.text;
                                scheduleRender();
                            }
                        } catch (e) {
                            if (e.message && !e.message.includes('JSON')) throw e;
                        }
                    }
                }
            } catch (streamErr) {
                console.error('Stream read error:', streamErr);
                // If we got some text, use it; otherwise re-throw
                if (!fullText) throw streamErr;
            }

            // Final render without cursor
            if (renderTimer) clearTimeout(renderTimer);
            if (contentEl) contentEl.innerHTML = formatNDA(fullText);
            if (loadingEl) loadingEl.classList.add('hidden');
            if (!fullText) throw new Error('No text was generated. Please try again.');
            return fullText;
        }

        async function generateNDA() {
            const prompt = buildPrompt1();
            document.getElementById('generateBtn1').disabled = true;
            document.getElementById('loadingState1').classList.remove('hidden');
            document.getElementById('result1').classList.add('hidden');

            try {
                const contentEl = document.getElementById('ndaContent1');
                const resultEl = document.getElementById('result1');
                const loadingEl = document.getElementById('loadingState1');

                generatedNDAText = await streamGenerate(prompt, contentEl, resultEl, loadingEl);
                renderStrengthMeter(1, false);
                document.getElementById('persistentBlocks').classList.remove('hidden');
                updateDocsPanel();
                updateBadge(1);

                savePartyData('A');
                savePartyData('B');
                saveToHistory('A', document.getElementById('partyAName').value, document.getElementById('partyAAddress').value, document.getElementById('partyAEmail').value, document.getElementById('partyAType').value, document.getElementById('partyACompanyNumber').value, document.getElementById('partyASignatory').value, document.getElementById('partyATitle').value);
                saveToHistory('B', document.getElementById('partyBName').value, document.getElementById('partyBAddress').value, document.getElementById('partyBEmail').value, document.getElementById('partyBType').value, document.getElementById('partyBCompanyNumber').value, document.getElementById('partyBSignatory').value, document.getElementById('partyBTitle').value);
            } catch (e) { alert('Error: ' + e.message); }
            finally {
                document.getElementById('loadingState1').classList.add('hidden');
                document.getElementById('generateBtn1').disabled = false;
            }
        }

        async function generateEnhancedNDA() {
            const prompt = buildPrompt2();
            document.getElementById('generateBtn2').disabled = true;
            document.getElementById('loadingState2').classList.remove('hidden');
            document.getElementById('result2').classList.add('hidden');

            try {
                const contentEl = document.getElementById('ndaContent2');
                const resultEl = document.getElementById('result2');
                const loadingEl = document.getElementById('loadingState2');

                generatedNDAText2 = await streamGenerate(prompt, contentEl, resultEl, loadingEl);
                renderStrengthMeter(2, true);
                updateDocsPanel();
                updateBadge(2);
            } catch (e) { alert('Error: ' + e.message); }
            finally {
                document.getElementById('loadingState2').classList.add('hidden');
                document.getElementById('generateBtn2').disabled = false;
            }
        }

        async function generateSummary() {
            const nda = generatedNDAText2 || generatedNDAText;
            const prompt = `You are a friendly legal communicator. Create a clear, professional plain-English summary of this NDA for the receiving party.

${nda}

REQUIREMENTS:
- Use a friendly but professional tone
- Structure with clear headings: "What is this agreement?", "What you're agreeing to", "What counts as confidential", "How long it lasts", "Your rights", "Key obligations"
- Explain each section simply without legal jargon
- When describing confidential information categories, list the specific categories selected (e.g. "business plans, financial data, technical trade secrets, customer lists") rather than saying information is defined "broadly" or "very broadly" ‚Äî be specific about what is covered
- Mention any specific protections or obligations (non-solicitation, return of materials, etc.)
- End with: "**This summary is provided for convenience only and does not constitute legal advice. The NDA itself is the binding document.**"
- Use markdown formatting for readability`;

            document.getElementById('generateBtn3').disabled = true;
            document.getElementById('loadingState3').classList.remove('hidden');
            document.getElementById('result3').classList.add('hidden');

            try {
                const contentEl = document.getElementById('summaryContent');
                const resultEl = document.getElementById('result3');
                const loadingEl = document.getElementById('loadingState3');

                generatedSummaryText = await streamGenerate(prompt, contentEl, resultEl, loadingEl);
                updateDocsPanel();
                updateBadge(5);
            } catch (e) { alert('Error: ' + e.message); }
            finally {
                document.getElementById('loadingState3').classList.add('hidden');
                document.getElementById('generateBtn3').disabled = false;
            }
        }

        function formatNDA(text) {
            marked.setOptions({ breaks: true, gfm: true });
            return marked.parse(text);
        }

        function copyText(text, btnEl) {
            const btn = btnEl || (typeof event !== 'undefined' ? event.target : null);
            navigator.clipboard.writeText(text).then(() => {
                if (!btn) return;
                const orig = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = orig, 1500);
            });
        }

        function downloadPDF(elementId, filename) {
            const element = document.getElementById(elementId);
            // Temporarily remove scroll constraints so html2pdf captures full content
            const origMaxH = element.style.maxHeight;
            const origOverflow = element.style.overflow;
            element.style.maxHeight = 'none';
            element.style.overflow = 'visible';

            const opt = {
                margin: [20, 18, 20, 18],
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['css', 'legacy'] }
            };
            html2pdf().set(opt).from(element).save().then(() => {
                // Restore scroll constraints
                element.style.maxHeight = origMaxH;
                element.style.overflow = origOverflow;
            }).catch(() => {
                element.style.maxHeight = origMaxH;
                element.style.overflow = origOverflow;
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Init ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('agreementDate').value = new Date().toISOString().split('T')[0];

            // Clear all party fields to prevent browser autofill persistence
            ['A', 'B'].forEach(party => {
                ['Name', 'CompanyNumber', 'Address', 'Email', 'Signatory', 'Title'].forEach(field => {
                    const el = document.getElementById(`party${party}${field}`);
                    if (el) el.value = '';
                });
                const typeEl = document.getElementById(`party${party}Type`);
                if (typeEl) typeEl.value = 'Company';
            });
            const searchA = document.getElementById('searchA');
            const searchB = document.getElementById('searchB');
            if (searchA) searchA.value = '';
            if (searchB) searchB.value = '';

            populateHistoryDropdowns();
            updateGoverningLawOptions();
            document.getElementById('partyAAddress').addEventListener('input', updateGoverningLawOptions);
            document.getElementById('partyBAddress').addEventListener('input', updateGoverningLawOptions);

            // Close dropdowns on outside click
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.autocomplete-wrap')) {
                    document.querySelectorAll('.autocomplete-dropdown').forEach(d => d.classList.add('hidden'));
                }
            });
        });
    </script>
</body>
</html>
